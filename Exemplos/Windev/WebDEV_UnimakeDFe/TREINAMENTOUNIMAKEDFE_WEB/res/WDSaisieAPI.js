/*! 27.0.2.0 */
/*! VersionVI: 01F280095g   */
function WDSaisieAPI(){arguments.length&&this.__construct.apply(this,arguments)}Element.prototype.matches||(Element.prototype.matches=Element.prototype.msMatchesSelector);String.prototype.endsWith||(String.prototype.endsWith=function(n,t){var i=this.toString(),r;return(typeof t!="number"||!isFinite(t)||Math.floor(t)!==t||t>i.length)&&(t=i.length),t-=n.length,r=i.lastIndexOf(n,t),r!==-1&&r===t});WDSaisieAPI.MODEUNDOREDO_NATIF=0;WDSaisieAPI.MODEUNDOREDO_AUCUN=1;WDSaisieAPI.MODEUNDOREDO_PROGRAMME=2;WDSaisieAPI.ms_sScriptURL=document.scripts[document.scripts.length-1].src;WDSaisieAPI.PLANCHE_NB_IMAGES=55;WDSaisieAPI.ms_sCodeInitial="<!DOCTYPE html>\n<html>\n\t<head>\n\t<\/head>\n\t<body>\n\t\t<p><\/p>\n\t<\/body>\n<\/html>";WDSaisieAPI.uuidv4=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(n){var t=Math.random()*16|0,i=n=="x"?t:t&3|8;return i.toString(16)})};WDSaisieAPI.OPTIONS_DEFAUT={innerHTML:undefined,bCreationLienAuto:undefined,bSansUndoRedoNatif:undefined,bEnModeMail:undefined,domStyleCommun:undefined,bGestionImages:undefined,bGestionLiens:undefined,bGestionTables:undefined,bBaliseP:undefined};WDSaisieAPI.prototype.__construct=function(n,t,i){WDSaisieAPI.gclSingleton=this;this.m_bModeWeb=!!n;this.m_oIFrame=t;this.m_oWindowPrincipale=window;this.m_oWindow=t.contentWindow||window;this.m_oDocument=this.m_oWindow.document;this.m_oBody=t.contentWindow?this.m_oDocument.body:t;this.m_oDocumentElement=t.contentWindow?this.m_oDocument.documentElement:t;this.m_oOptions=i||WDSaisieAPI.OPTIONS_DEFAUT;this.m_eModeUndoRedo=window.clWDUtil&&bIEAvec11?WDSaisieAPI.MODEUNDOREDO_NATIF:WDSaisieAPI.MODEUNDOREDO_PROGRAMME;this.m_oOptions.bSansUndoRedoNatif===!0?this.m_eModeUndoRedo=WDSaisieAPI.MODEUNDOREDO_AUCUN:this.m_oOptions.bSansUndoRedoNatif===!1&&(this.m_eModeUndoRedo=WDSaisieAPI.MODEUNDOREDO_NATIF);this.m_oElementCourant=undefined;this.m_nNombreDesactivationsEcoute=0;this.m_nomPoliceDefaut="Arial,Helvetica,sans-serif";this.m_taillePoliceDefaut="initial";for(sMethode in WDSaisieAPI.prototype)WDSaisieAPI[sMethode]=WDSaisieAPI.prototype[sMethode].bind(WDSaisieAPI.gclSingleton);this.m_tabUndoRedo=[{}];this.m_nIndiceUndoRedo=0;this._surInputGestionLien=this._surInputGestionLien.bind(this);this._surInputPourUndoRedo=this._surInputPourUndoRedo.bind(this);this.m_oIFrame.contentWindow?i.innerHTML!==undefined&&this.SetProp_Valeur(i.innerHTML):this.SetProp_Valeur(this.m_oIFrame.innerHTML)};WDSaisieAPI.prototype.ExecuteEditeurImage=function(n,t){this.m_oWindowPrincipale.wbEditeurImageFactory===!1?t():this.m_bModeWeb&&this.m_oWindowPrincipale.wbEditeurImageFactory===undefined?$.ajax({dataType:"script",cache:!0,url:WDSaisieAPI.ms_sScriptURL.replace("WDSaisieAPI","WDEditeurImage")}).done(n).fail(t):this.m_oWindowPrincipale.wbEditeurImageFactory&&n()};WDSaisieAPI.prototype.TestOK=function(){return 1};WDSaisieAPI.prototype.Set_designMode=function(n){var t=n==="on"||n==="ON"||n===!0;this.m_oDocument.designMode=t?"on":"off";t&&(this.m_oDocument.execCommand("styleWithCSS",!1,!this.m_oOptions.bEnModeMail),this.m_oOptions.bBaliseP!==undefined&&this.m_oDocument.execCommand("defaultParagraphSeparator",!1,this.m_oOptions.bBaliseP?"p":"div"))};WDSaisieAPI.prototype.execCommand=function(n){var t=n==="undo",i=n==="redo";if((t||i)&&this.m_eModeUndoRedo===WDSaisieAPI.MODEUNDOREDO_PROGRAMME){t?this.CMD_Annuler():this.CMD_Retablir();return}this.m_oDocument.execCommand(n)};WDSaisieAPI.prototype._bUndoPossible=function(){switch(this.m_eModeUndoRedo){case WDSaisieAPI.MODEUNDOREDO_NATIF:case WDSaisieAPI.MODEUNDOREDO_AUCUN:return this.m_oDocument.queryCommandEnabled("undo");case WDSaisieAPI.MODEUNDOREDO_PROGRAMME:return this.m_nIndiceUndoRedo>0}};WDSaisieAPI.prototype._bRedoPossible=function(){switch(this.m_eModeUndoRedo){case WDSaisieAPI.MODEUNDOREDO_NATIF:case WDSaisieAPI.MODEUNDOREDO_AUCUN:return this.m_oDocument.queryCommandEnabled("redo");case WDSaisieAPI.MODEUNDOREDO_PROGRAMME:return this.m_nIndiceUndoRedo<this.m_tabUndoRedo.length-1}};WDSaisieAPI.prototype.CMD_Annuler=function(){if(this._bUndoPossible())switch(this.m_eModeUndoRedo){case WDSaisieAPI.MODEUNDOREDO_NATIF:case WDSaisieAPI.MODEUNDOREDO_AUCUN:this.m_oDocument.execCommand("undo",!1);break;case WDSaisieAPI.MODEUNDOREDO_PROGRAMME:this._deserialiseUndo(this.m_tabUndoRedo[--this.m_nIndiceUndoRedo])}};WDSaisieAPI.prototype.CMD_Retablir=function(){if(this._bRedoPossible())switch(this.m_eModeUndoRedo){case WDSaisieAPI.MODEUNDOREDO_NATIF:case WDSaisieAPI.MODEUNDOREDO_AUCUN:this.m_oDocument.execCommand("redo",!1);break;case WDSaisieAPI.MODEUNDOREDO_PROGRAMME:this._deserialiseUndo(this.m_tabUndoRedo[++this.m_nIndiceUndoRedo])}};WDSaisieAPI.prototype._surInputPourUndoRedo=function(n){if(n||(n={}),n.inputType==="historyUndo"){n.preventDefault();n.stopPropagation();this.CMD_Annuler();return}if(n.inputType==="historyRedo"){n.preventDefault();n.stopPropagation();this.CMD_Retablir();return}if(n.inputType==="insertText"&&this.m_tabUndoRedo.length&&this.m_tabUndoRedo[this.m_tabUndoRedo.length-1].inputType===n.inputType){this.m_tabUndoRedo[this.m_tabUndoRedo.length-1]=this._serialiseUndo();return}this.m_tabUndoRedo=this.m_tabUndoRedo.slice(0,++this.m_nIndiceUndoRedo);this.m_tabUndoRedo.push(this._serialiseUndo());this.m_tabUndoRedo[this.m_tabUndoRedo.length-1].inputType=n.inputType};WDSaisieAPI.prototype._serialiseUndo=function(){var n=this.saveSelection(),t=this.m_oIFrame.contentWindow?this.m_oBody.innerHTML:this.m_oIFrame.innerHTML;return n.html=t,n};WDSaisieAPI.prototype._deserialiseUndo=function(n){var t=this.m_oIFrame.contentWindow?this.m_oBody:this.m_oIFrame;t.innerHTML=n.html||"";$(t).find(".wbSaisieRicheWrapperSelection").remove();this.restoreSelection(n)};WDSaisieAPI.prototype._surInputGestionLien=function(n){var t=this.__oGetSelection(),s,y,o,h,c,u,a,l,p,i;if(t&&t.focusNode&&(t.focusNode.nodeType===Node.TEXT_NODE||t.focusNode.nodeType===Node.ELEMENT_NODE)&&(this.m_sDerniereValeurHtmlAffectee=undefined,this.onModifHtml(),this.m_oOptions.bCreationLienAuto!==!1)){if(n.inputType==="deleteContentBackward"&&(s=$(t.focusNode.parentElement),s.length&&(s.attr("href")||"").length)){i=this.m_oDocument.createRange();i.selectNode(s.get(0));t.removeAllRanges();t.addRange(i);this.CMD_SupprimeLien();t.collapse(t.focusNode,t.focusNode.textContent.length);return}if(n.inputType==="insertParagraph"||n.data===" "){var f="",r=t.focusNode,e=t.anchorOffset-1,v=1;if(n.inputType==="insertParagraph")if(t.focusNode&&t.focusOffset>1&&t.focusNode.childNodes.length>t.focusOffset&&t.focusNode.childNodes[t.focusOffset].tagName.toLowerCase()==="br"){for(y=document.createNodeIterator(t.focusNode,NodeFilter.SHOW_TEXT+NodeFilter.SHOW_ELEMENT),f="";o=y.nextNode();)if(o.nodeType===Node.TEXT_NODE)f+=o.textContent,r=o;else if(o===t.focusNode.childNodes[t.focusOffset])break;v=0;e=r.length}else if(t.focusNode&&(h=t.focusNode.nodeType!==Node.ELEMENT_NODE||!t.focusNode.textContent.length?t.focusNode.parentElement:t.focusNode,h&&h.previousSibling)){for(r=h.previousElementSibling;r.lastChild;)r=r.lastChild;e=r.length;v=0}if(f=f||r.textContent.substr(0,e),!f)return;if(c=f.split(/(\s|\n)/g),!c.length)return;if(u=c[c.length-1],!u)return;a=!1;(u.indexOf("://")!==-1||(a=u.indexOf("www.")===0))&&(l=this.__oGetSelection(),p=l.focusNode,this._DesactiveEcoute_SelectionChanged(),i=this.m_oDocument.createRange(),i.setStart(r,e-u.length),i.setEnd(r,e),t.removeAllRanges(),t.addRange(i),a&&(u="//"+u),this.CMD_ChangeLien(u),l.removeAllRanges(),i=this.m_oDocument.createRange(),i.selectNode(p),l.addRange(i),i.collapse(!1),this._ActiveEcoute_SelectionChanged())}}};WDSaisieAPI.prototype.bSelectionACorriger=function(){var n=this.__oGetSelection(),t,i;return n?n.type=="None"?!0:n.type=="Range"?!1:(t=this.oGetRange(),!t)?!0:t.startOffset!=0?!1:(i=this.GetProp_Selection(),i.debut!=0)?!1:!0:!0};WDSaisieAPI.prototype.CorrigeSelectionSurSetFocus=function(){this.bSelectionACorriger()&&this.CMD_Selectionne(0,0)};WDSaisieAPI.prototype.ForceSelectionDansDoc=function(){if(this.m_oIFrame.contentWindow){var n=this.m_oWindowPrincipale.getSelection();n.containsNode(this.m_oIFrame)&&(this._DesactiveEcoute_SelectionChanged(),n.removeAllRanges(),this.m_oIFrame.focus(),this._ActiveEcoute_SelectionChanged())}};WDSaisieAPI.prototype._onSelectionChanged=function(){var t,i,n,r;if(window.WL&&!this.m_bInSelectionChanged){this.m_bInSelectionChanged=!0;t=this.__oGetSelection();i={};for(n in t)typeof t[n]!="function"&&(i[n]=t[n]);r=!1;for(n in i)if(!this.m_oSelectionPrecedente||this.m_oSelectionPrecedente[n]===undefined||t[n]!=this.m_oSelectionPrecedente[n]){r=!0;break}r&&(this.m_oSelectionPrecedente=$.extend({},i),this.m_nTimerSELECTIONCHANGE&&clearTimeout(this.m_nTimerSELECTIONCHANGE),this.m_nTimerSELECTIONCHANGE=setTimeout(function(){WL.Execute(this.sGetWLEXEC("WLEXEC_SELECTIONCHANGE"),"")}.bind(this),300));this.m_oSelectionPrecedente=i;this.m_bInSelectionChanged=!1}};WDSaisieAPI.prototype._ActiveEcoute_SelectionChanged=function(){(--this.m_nNombreDesactivationsEcoute,this._AutoriseEcoute_SelectionChanged())&&(this.m_oObserver&&this.m_oObserver.observe(this.m_oDocument,{attributes:!0,childList:!0,subtree:!0,characterData:!1}),this.m_oDocument.addEventListener("selectionchange",this._onSelectionChanged.bind(this)))};WDSaisieAPI.prototype._DesactiveEcoute_SelectionChanged=function(){++this.m_nNombreDesactivationsEcoute;this.m_oObserver&&this.m_oObserver.disconnect();this.m_oDocument.removeEventListener("selectionchange",this._onSelectionChanged.bind(this))};WDSaisieAPI.prototype._AutoriseEcoute_SelectionChanged=function(){return this.m_nNombreDesactivationsEcoute===0};WDSaisieAPI.prototype.GetDocument=function(){return this.m_oDocument};WDSaisieAPI.prototype.ExecuteJSDansContexte=function(n){return this.m_oWindow.eval(n)};WDSaisieAPI.prototype.SetProp_StyleRoot=function(n){this.m_bForceStyleCssRoot=!0;this.m_oDocumentElement.removeAttribute("class");this.m_oDocumentElement.setAttribute("style",n)};WDSaisieAPI.prototype.SetProp_ValeurBodyInner=function(n){this.m_oDocument.body.innerHTML=n;this.m_sDerniereValeurHtmlAffectee=undefined};WDSaisieAPI.prototype.SetProp_Valeur=function(n,t){var i,u;if(this.m_oBody.removeEventListener("input",this._surInputPourUndoRedo),this._DesactiveEcoute_SelectionChanged(),this.m_oIFrame.contentWindow?(this.m_oDocument.open(),this.m_oDocument.write(n||WDSaisieAPI.ms_sCodeInitial),this.m_oDocument.close(),this.m_sDerniereValeurHtmlAffectee=n,this.m_oDocument||(this.m_oDocument.open(),this.m_oDocument.write(WDSaisieAPI.ms_sCodeInitial),this.m_oDocument.close(),this.m_sDerniereValeurHtmlAffectee=undefined),this.m_oDocumentElement=this.m_oDocument.documentElement,this.m_oBody=this.m_oDocument.body):(this.m_oIFrame.innerHTML=n,n||this.m_oIFrame.tagName.toLowerCase()!=="html"||(this.m_oIFrame.innerHTML=WDSaisieAPI.ms_sCodeInitial)),Array.prototype.forEach.call(document.getElementsByTagName("meta"),function(n){n.getAttribute("charset")&&n.setAttribute("charset","utf-8");(n.getAttribute("http-equiv")||"").toLowerCase()=="content-type"&&n.setAttribute("content",n.getAttribute("content").split(";").filter(function(n){return n.toLowerCase().indexOf("charset")==-1}).join(";"))}),this.m_bModeWeb&&!this.m_oIFrame.contentWindow&&this.m_oIFrame.tagName.toLowerCase()==="body"&&this.Set_designMode(!0),this.m_tabBaliseCssAjoutee=undefined,!t&&this.m_oOptions&&this.m_oOptions.domStyleCommun){i=clWDUtil.isArray(this.m_oOptions.domStyleCommun)?this.m_oOptions.domStyleCommun:[this.m_oOptions.domStyleCommun];u=this.m_oDocument.createElement("style");u.innerHTML="::selection { color:inherit; background:rgba(0,0,0,0.22); }";i.push(u);var r=this.m_oWindow.getComputedStyle(this.m_oBody),f=clWDUtil.tabHTML2RVBA(r.color),o=clWDUtil.tabHTML2RVBA(r.backgroundColor),s="rgba("+f[0]+", "+f[1]+", "+f[2]+", 0.15)",e=this.m_oDocument.createElement("style");e.innerHTML=".wbSaisieRicheBarre{ background-color:"+(o[3]===0?"white":r.backgroundColor)+";border-color:"+r.borderColor+";}.wbBarreOutilsMiniBarreLi:hover{background-color:"+s+";}";i.push(e);this.m_tabBaliseCssAjoutee=i.concat(clWDUtil.isArray(this.m_oOptions.domStyleCommun)?this.m_oOptions.domStyleCommun:[this.m_oOptions.domStyleCommun]);this._RemetStyleInterne(!0)}this.m_bModeWeb||(window.document.onselectionchange=function(){this.ForceSelectionDansDoc()}.bind(this));this.__InitGestionJS();this.CMD_Selectionne(0,0);window.WL&&(this.m_oObserver=new MutationObserver(function(n){var o=!1,s=0,u,i,f,h,t,e,r;for(iMutation in n)if(n[iMutation]){if(u=n[iMutation],this.m_bForceStyleCssRoot&&u.target==this.m_oDocumentElement){if(u.attributeName=="class")continue;if(u.attributeName=="style")continue}if(s++,n[iMutation].type==="childList"){for(i=0;i<(n[iMutation].addedNodes||[]).length;++i)if(n[iMutation].addedNodes[i]&&n[iMutation].addedNodes[i].nodeType===Node.ELEMENT_NODE){f=!1;h=n[iMutation].addedNodes[i].tagName.toLowerCase();switch(h){case"table":case"td":case"tr":case"th":case"p":case"div":case"ul":case"ol":case"li":case"dl":case"dt":case"dd":f=!0}f&&(t=n[iMutation].addedNodes[i],e="\n",t.parentElement&&t.parentElement.previousSibling&&t.parentElement.previousSibling.nodeType==Node.TEXT_NODE&&t.parentElement.previousSibling.textContent.replace(/[\r\n\t\s]/g,"").length===0&&(e=t.parentElement.previousSibling.textContent+"\t"),t.parentElement&&t.parentElement.insertBefore&&(this._DesactiveEcoute_SelectionChanged(),t.parentElement.insertBefore(this.m_oDocument.createTextNode(e),t),this._ActiveEcoute_SelectionChanged()))}if(r=n[iMutation].addedNodes||n[iMutation].removedNodes,r)for(iNode in r)if(r[iNode]&&r[iNode].outerHTML&&(!r[iNode].parentElement||r[iNode].outerHTML.indexOf("sizzle")>-1)){o=!0;break}}}o||s!=0&&(this.m_sDerniereValeurHtmlAffectee=undefined,this.onModifHtml())}.bind(this)));this._ActiveEcoute_SelectionChanged();this.m_oBody.addEventListener("input",this._surInputPourUndoRedo);this.m_oBody.addEventListener("input",this._surInputGestionLien);this.m_oBody.addEventListener("keydown",function(n){if(n.ctrlKey&&n.key==="b"){this.CMD_Gras();this.m_oDocument.documentElement.wdSaisieRiche&&this.m_oDocument.documentElement.wdSaisieRiche.RafBarre(undefined,!0);n.stopPropagation();n.preventDefault();return}if(n.ctrlKey&&n.key==="i"){this.CMD_Italique();this.m_oDocument.documentElement.wdSaisieRiche&&this.m_oDocument.documentElement.wdSaisieRiche.RafBarre(undefined,!0);n.stopPropagation();n.preventDefault();return}if(n.ctrlKey&&n.key==="u"){this.CMD_Souligne();this.m_oDocument.documentElement.wdSaisieRiche&&this.m_oDocument.documentElement.wdSaisieRiche.RafBarre(undefined,!0);n.stopPropagation();n.preventDefault();return}if(n.key==="Tab"&&!n.ctrlKey){var t=$(this.__oGetSelection().focusNode);if(!(t.closest("td").length>0)){if(t.closest("li").length===0){if(this.m_oOptions.onTab)this.m_oOptions.onTab(!n.shiftKey);return}n.shiftKey?this.CMD_DiminueRetrait():this.CMD_AugmenteRetrait();n.preventDefault();n.stopPropagation()}}}.bind(this));window.WL&&WL.Execute(this.sGetWLEXEC("WLEXEC_ONLOAD"),"")};WDSaisieAPI.prototype.onModifHtml=function(){if(window.WL){var n="";this.m_bForceStyleCssRoot&&(n=this.getTailleTexteHtml());WL.Execute("htmlchange",n)}};WDSaisieAPI.prototype.getTailleTexteHtml=function(){const t=this.m_oDocument.body.children;var n=t.length===0?this.m_oDocument.body.getBoundingClientRect():t[0].getBoundingClientRect();for(let i=1;i<t.length;i++)rectI=t[i].getBoundingClientRect(),rectI.right>n.right&&(growX=rectI.right-n.right,n=new DOMRect(n.left,n.top,n.width+growX,n.height)),rectI.bottom>n.bottom&&(growY=rectI.bottom-n.bottom,n=new DOMRect(n.left,n.top,n.width,n.height+growY));return sTaille=""+n.width+";"+n.height};WDSaisieAPI.prototype.SetDocumentDefaut=function(n,t,i){if(this.SetProp_Valeur('<html style="font-family:'+this.m_nomPoliceDefaut+";font-size:"+this.m_taillePoliceDefaut+';"><body>\n<\/body><\/html>'),this.m_oDocumentElement.style.color=n,this.m_oDocumentElement.style.backgroundColor=t,i&&!n&&!t){var r=this.m_oDocument.createElement("style");r.innerHTML=" @media(prefers-color-scheme: dark) { html  { background: black; color: white; } } @media(prefers-color-scheme: light) { html  { color: black; background: white; } }";this.m_oDocument.head.insertBefore(r,this.m_oDocument.head.firstElementChild)}};WDSaisieAPI.prototype.CMD_ChangeNomPoliceDefaut=function(n){this.m_nomPoliceDefaut=n;n===""&&(n="Arial,Helvetica,sans-serif");this.m_oDocument.documentElement.style.fontFamily=n};WDSaisieAPI.prototype.CMD_ChangeTaillePoliceDefaut=function(n){this.m_oDocument.documentElement.style.fontSize=n;this.m_taillePoliceDefaut=n};WDSaisieAPI.prototype.InitSelection=function(){this.m_oIFrame.focus();this.CMD_Selectionne(0,0)};WDSaisieAPI.prototype._RetireStyleInterne=function(){if(this._DesactiveEcoute_SelectionChanged(),this.m_tabBaliseCssAjoutee&&clWDUtil.bForEach(this.m_tabBaliseCssAjoutee,function(n){return n.remove(),!0}),window.$){var n=this.m_oDocument,t=$(n.body);t.trigger("trigger.wb.saisieriche.deselectionneTout")}this.m_domStyleSelectionTransparent&&this.m_domStyleSelectionTransparent.remove();this._ActiveEcoute_SelectionChanged()};WDSaisieAPI.prototype._RemetStyleInterne=function(n){var i,t;if(this.m_tabBaliseCssAjoutee&&this.m_tabBaliseCssAjoutee.length){for(this._DesactiveEcoute_SelectionChanged(),i=this.m_tabBaliseCssAjoutee.length-1;i>=0;--i)t=this.m_tabBaliseCssAjoutee[i],n&&(t.href?t.href+="?"+Math.random(1,999):t.innerHTML+=".truc"+(Math.random(1,999)+"").replace(/\./g,"")+"{ will-change:opacity; }"),this.m_oDocument.head.insertBefore(t,this.m_oDocument.head.firstElementChild);this._ActiveEcoute_SelectionChanged()}};WDSaisieAPI.prototype.GetProp_ValeurBodyInner=function(){return this.m_oDocument.body.innerHTML};WDSaisieAPI.prototype.GetProp_Valeur=function(){var n,t,i;return this.m_sDerniereValeurHtmlAffectee?this.m_sDerniereValeurHtmlAffectee:(this._DesactiveEcoute_SelectionChanged(),this._RetireStyleInterne(),sSauveAttrClass=function(n){var t=$(n),i=t.attr("class")||"";return t.attr("class",i.split(" ").filter(function(n){return n.indexOf("wbSaisieRiche")===-1}).join(" ")).attr("class")==""&&t.removeAttr("class"),i},n=sSauveAttrClass(this.m_oBody),t=sSauveAttrClass(this.m_oDocumentElement),$(this.m_oDocument.getElementsByTagName("span")).each(function(){this.innerHTML.charCodeAt(0)===8203&&(this.innerHTML=this.innerHTML.substr(1));this.innerHTML.length===0&&this.remove()}),i=this.m_oDocumentElement.outerHTML.replace(/\u200b/g,""),this._RemetStyleInterne(),$(this.m_oDocumentElement).attr("class",t),$(this.m_oBody).attr("class",n),this._ActiveEcoute_SelectionChanged(),i)};WDSaisieAPI.prototype.GetProp_ValeurBody=function(){return this.m_oBody.outerHTML};WDSaisieAPI.prototype.GetProp_ValeurPlain=function(){return this.m_oBody.innerText};WDSaisieAPI.prototype.SetProp_ValeurBody=function(n){this.m_sDerniereValeurHtmlAffectee=undefined;this.m_oBody.outerHTML=n};WDSaisieAPI.prototype.CMD_RemoveClass=function(n){this.CMD_ChangeStyle(function(t){$(t).removeClass(n)}.bind(this))};WDSaisieAPI.prototype.CMD_RemoveClass_Filter_StartWith=function(n){this.CMD_ChangeStyle(function(t){var i=[];t.classList.forEach(function(t){t.toString().startsWith(n)&&i.push(t)});i.length>0&&i.forEach(function(n){t.classList.remove(n)})}.bind(this))};WDSaisieAPI.prototype.VisitTagsInRange=function(n){for(var f=this.__oGetSelection(),o=f.getRangeAt(0),e=document.createNodeIterator(document.body,NodeFilter.SHOW_TEXT),t,i=!1,u=$();t=e.nextNode();)if(t===r.startContainer&&(i=!0),i&&(u=u.add($(t.parentElement))),t===r.endContainer){i=!1;break}u.each(n)};WDSaisieAPI.prototype.CMD_AddAttribute=function(n,t){this.CMD_ChangeStyle(function(i){$(i).attr(n,t)}.bind(this),!0,!0)};WDSaisieAPI.prototype.CMD_CaretMemoireOuCommandRange=function(n,t,i){var r=this.__oGetSelection();r.type==="Caret"?this.CMD_ChangeStyle(t,!0,i):clWDUtil.isArray(n)?this.m_oDocument.execCommand.apply(this.m_oDocument,n):this.m_oDocument.execCommand(n)};WDSaisieAPI.prototype.CMD_SetFocus=function(){this.m_oDocumentElement.focus()};WDSaisieAPI.prototype.CMD_Imprimer=function(){window.print()};WDSaisieAPI.prototype.CMD_Gras=function(){var n=this.GetProp_Selection(!0);n&&(n=!!n.style.police.gras);this.CMD_CaretMemoireOuCommandRange("bold",function(t){t.style.fontWeight=n?"normal":"bold"})};WDSaisieAPI.prototype.CMD_Italique=function(){var n=this.GetProp_Selection(!0);n&&(n=!!n.style.police.italique);this.CMD_CaretMemoireOuCommandRange("italic",function(t){t.style.fontStyle=n?"normal":"italic"}.bind(this))};WDSaisieAPI.prototype.CMD_Souligne=function(){var n=this.GetProp_Selection(!0),t="none";n&&(t=n.style.police.barre?"line-through ":"",n=!!n.style.police.souligne);this.CMD_CaretMemoireOuCommandRange("underline",function(i){for(var r=i;r&&r!==this.m_oBody;r=r.parentElement)r.style.textDecoration=n?t||"none":t+"underline"}.bind(this),!0)};WDSaisieAPI.prototype.CMD_Barre=function(){var n=this.GetProp_Selection(!0),t="";n&&(t=n.style.police.souligne?"underline ":"",n=!!n.style.police.barre);this.CMD_CaretMemoireOuCommandRange("strikethrough",function(i){for(var r=i;r&&r!==this.m_oBody;r=r.parentElement)r.style.textDecoration=n?t||"none":t+"line-through"}.bind(this),!0)};WDSaisieAPI.prototype.CMD_Exposant=function(){var i=this.__oGetSelection(),r,n,t;if(this.bSelectionEstALaFin(i)&&(r=this.GetProp_Selection(!0),r.style.police.exposant)){n=this.m_oDocument.createElement("span");n.innerHTML="\u200b";t=this.m_oBody.lastChild;t&&t.tagName=="DIV"?t.appendChild(n):this.m_oBody.appendChild(n);i.selectAllChildren(this.m_oBody);i.collapseToEnd();return}this.m_oDocument.execCommand("superscript")};WDSaisieAPI.prototype.CMD_Indice=function(){this.m_oDocument.execCommand("subscript")};WDSaisieAPI.prototype.CMD_ChangeAligne=function(n){switch(n){case 0:return this.CMD_AligneGauche();case 1:return this.CMD_AligneCentre();case 2:return this.CMD_AligneDroite();case 3:return this.CMD_AligneJustifie()}};WDSaisieAPI.prototype.CMD_AligneGauche=function(){var n=this.oGetRange(),t;n&&n.commonAncestorContainer&&n.commonAncestorContainer.querySelectorAll&&(t=n.commonAncestorContainer.querySelectorAll("div"),t.forEach(function(n){n.style&&n.style.textAlign&&(n.style.textAlign="")}));this.m_oDocument.execCommand("justifyLeft")};WDSaisieAPI.prototype.CMD_AligneCentre=function(){this.m_oDocument.execCommand("justifyCenter")};WDSaisieAPI.prototype.CMD_AligneDroite=function(){this.m_oDocument.execCommand("justifyRight")};WDSaisieAPI.prototype.CMD_AligneJustifie=function(){this.m_oDocument.execCommand("justifyFull")};WDSaisieAPI.prototype.CMD_AugmenteRetrait=function(){this.m_oDocument.execCommand("indent")};WDSaisieAPI.prototype.CMD_DiminueRetrait=function(){this.m_oDocument.execCommand("outdent")};WDSaisieAPI.prototype.CMD_ChangeCouleurTexte=function(n){this.m_oDocument.execCommand("foreColor",!1,n)};WDSaisieAPI.prototype.CMD_ChangeCouleurFondTexte=function(n){var t="transparent",i=this.__oGetSelection(),o=i.getRangeAt(0),r,u,f,e;if(n=="-1"&&i.type==="Caret")t="rgba(0, 0, 0, 0.01)",r=new MutationObserver(function(n,i){for(var u,f,r=0;r<n.length;++r)for(u=0;u<(n[r].addedNodes||[]).length;++u)if(n[r].addedNodes[u]&&n[r].addedNodes[u].style&&n[r].addedNodes[u].style.backgroundColor===t){i.disconnect();f=n[r].addedNodes[u];f.style.backgroundColor="transparent";return}}.bind(this)),r.observe(this.m_oDocument,{attributes:!1,childList:!0,subtree:!0,characterData:!0}),u=function(){r.disconnect();this.m_oDocument.removeEventListener("selectionchange",u)}.bind(this),this.m_oDocument.addEventListener("selectionchange",u);else if(i.type==="Range"&&o.commonAncestorContainer.nodeType==Node.TEXT_NODE){this.CMD_ChangeStyle(function(i){i.style.backgroundColor=n=="-1"?t:n}.bind(this));return}f=this.m_oBody.style.backgroundColor;this.m_oDocument.execCommand("hiliteColor",!1,n=="-1"?t:n);f!==this.m_oBody.style.backgroundColor&&(e=this.saveSelection(),this.m_oBody.style.backgroundColor=f,this.m_oBody.innerHTML='<span style="background-color:'+n+'">'+this.m_oBody.innerHTML+"<\/span>",this.restoreSelection(e))};WDSaisieAPI.prototype.CMD_ChangeCouleurFondDoc=function(n){n==-1&&(n=undefined);this.m_oBody.style.backgroundColor=n;this.m_sDerniereValeurHtmlAffectee=undefined};WDSaisieAPI.prototype.SelectionneLienParent=function(){var t=this.__oGetSelection(),n,i;if(t.type!="None"&&(n=t.getRangeAt(0),i=n.commonAncestorContainer),n)for(elemParent=n.startContainer;elemParent;){if(elemParent.tagName=="A"){t.selectAllChildren(elemParent);return}elemParent=elemParent.parentElement}};WDSaisieAPI.prototype.CMD_ChangeLien=function(n){this.SelectionneLienParent();this.m_oDocument.execCommand("createLink",!1,n);this.m_sDerniereValeurHtmlAffectee=undefined};WDSaisieAPI.prototype.CMD_SupprimeLien=function(){this.SelectionneLienParent();this.m_oDocument.execCommand("unlink");this.m_sDerniereValeurHtmlAffectee=undefined};WDSaisieAPI.prototype.CMD_AugmenteTaillePolice=function(){this.CMD_ChangeStyle(function(n){oStyleEffectif=this.oGetCurrentStyle(n);var t=parseInt(oStyleEffectif.fontSize);t+=t<14?1:2;n.style.fontSize=t+"px"}.bind(this),!0)};WDSaisieAPI.prototype.CMD_DiminueTaillePolice=function(){this.CMD_ChangeStyle(function(n){oStyleEffectif=this.oGetCurrentStyle(n);var t=parseInt(oStyleEffectif.fontSize);t<=4||(t-=t<14?1:2,n.style.fontSize=t+"px")}.bind(this),!0)};WDSaisieAPI.prototype.CMD_ChangeNomPolice=function(n){this.CMD_CaretMemoireOuCommandRange(["fontName",!1,n],function(t){t.style.fontFamily=n})};WDSaisieAPI.prototype.CMD_CreePuceAvecNumero=function(){this.m_oDocument.execCommand("insertOrderedList")};WDSaisieAPI.prototype.CMD_CreePuceSansNumero=function(){this.m_oDocument.execCommand("insertUnorderedList")};WDSaisieAPI.prototype.CMD_AddClass=function(n){this.CMD_ChangeStyle(function(t){$(t).addClass(n)}.bind(this))};WDSaisieAPI.prototype.CMD_GetTexteSelection=function(){var n=this.__oGetSelection();return n.toString()};WDSaisieAPI.prototype.Set_VerifieOrthographe=function(){this.m_oBody.spellcheck="false"};WDSaisieAPI.prototype.CMD_Copier=function(){this.m_oDocument.execCommand("copy")};WDSaisieAPI.prototype.CMD_Couper=function(){this.m_oDocument.execCommand("cut")};WDSaisieAPI.prototype.CMD_Coller=function(n){var t=this.oGetRange();t.deleteContents();newNode=document.createTextNode(n);t.insertNode(newNode);t.select&&(t.select(),t.collapse(!1),t.scrollIntoView())};WDSaisieAPI.prototype.CMD_CollerHtml=function(n){this.CMD_InsereHtml(n)};WDSaisieAPI.prototype.__oGetSelection=function(){var n=this.m_oDocument.defaultView;return n&&n.getSelection?n.getSelection():this.m_oDocument.getSelection?this.m_oDocument.getSelection():undefined};WDSaisieAPI.prototype.oGetRange=function(){var n=this.__oGetSelection();return n&&n.rangeCount?n.getRangeAt(0):null};WDSaisieAPI.prototype.oGetCurrentStyle=function(n,t){var u=function(){var t;if(n.currentStyle)return n.currentStyle;if(t=n.defaultView||(n.ownerDocument||this.m_oDocument).defaultView,t.getComputedStyle){n.nodeName=="#text"&&(n=n.parentNode);try{return t.getComputedStyle(n,null)}catch(i){return{}}}return{}}.bind(this),i=u(),r;return t?(r=$.extend({},i),this.MAJStyleSelonParentR(r,i),r):i};WDSaisieAPI.prototype.MAJStyleSelonParentR=function MAJStyleSelonParentR(n,t){var i,r,u;if(n.parentElement&&Element.parentElement!=this.m_oBody){if(i=this._nGetAlphaColor(t.backgroundColor)===0,r=t.textDecorationLine==="none",!i&&!r)return;if(u=oGetCurrentStyle(n.parentElement,!1),i&&this._nGetAlphaColor(u.backgroundColor)!==0&&(t.backgroundColor=u.backgroundColor,i=!1),r&&u.textDecorationLine!=="none"&&(t.textDecorationLine=u.textDecorationLine,r=!1),!i&&!r)return;MAJStyleSelonParentR(n.parentElement,t)}};WDSaisieAPI.prototype.CMD_ChangeInterlettrage=function(n){this.CMD_ChangeStyle(function(t){t.style.letterSpacing=n;$(t).find("[style*=letter-spacing]").css("letter-spacing","")}.bind(this),!0)};WDSaisieAPI.prototype.CMD_ChangeTaillePolice=function(n){this.CMD_ChangeStyle(function(t){t.style.fontSize=n;$(t).find("[style*=font-size]").css("font-size","")}.bind(this),!0)};WDSaisieAPI.prototype.CMD_ChangeFormatBlock=function(n){this.m_oDocument.execCommand("FormatBlock",!1,n)};WDSaisieAPI.prototype.EmpileUndoRedo=function(n,t,i){var o,s,r,h,u,f,e,c;return this.m_eModeUndoRedo!==WDSaisieAPI.MODEUNDOREDO_NATIF?(o=i?i(t(),n):t(),this.NotifieApresModification(),o):(this.m_bUndoRedoEnCours=!0,s=this.saveSelection(),r=n[0],r.classList.add("wbEmpileUndoRedo"),h=r.outerHTML,u=t(),u&&r.parentElement&&(f=this.__oGetSelection(),e=this.m_oDocument.createRange(),f.removeAllRanges(),r.classList.remove("wbEmpileUndoRedo"),c=r.outerHTML,r.classList.add("wbEmpileUndoRedo"),r.outerHTML=h,r=this.m_oBody.getElementsByClassName("wbEmpileUndoRedo")[0],r.classList.remove("wbEmpileUndoRedo"),e.selectNode(r),f.addRange(e),this.m_oDocument.execCommand("insertHTML",!1,c),n=$(f.focusNode).closest(r.tagName.toLowerCase())),this.restoreSelection(s),i&&(u=i(u,n)),this.m_bUndoRedoEnCours=!1,u)};WDSaisieAPI.prototype.CMD_ChangeStyle=function(n,t,i){var h=this.__oGetSelection(),nt=h.type==="Caret",e,c,w,b,p,d,v,y,g,s;if(h.type!=="None"){var o=h.getRangeAt(0),u=o.cloneRange(),tt=this.saveSelection(),r=this.m_oBody,a=function(){var n;return n=u.commonAncestorContainer.nodeType==Node.TEXT_NODE?u.commonAncestorContainer.parentElement:u.commonAncestorContainer,n||r}.bind(this),f=!1;if(nt){if(t){this._DesactiveEcoute_SelectionChanged();e=this.m_oDocument.createElement("span");e.appendChild(this.m_oDocument.createTextNode(String.fromCharCode(8203)));c=o.commonAncestorContainer.nodeType==Node.TEXT_NODE?o.commonAncestorContainer.parentElement:o.commonAncestorContainer;w=function(){return o.startOffset!==o.endOffset?!1:o.commonAncestorContainer.nodeType===Node.ELEMENT_NODE?o.endOffset===o.childElementCount:o.endOffset===o.commonAncestorContainer.length}();i&&w&&this.m_oBody!==c&&c.parentElement!=this.m_oBody?c.parentElement.insertBefore(e,c.nextSibling):o.insertNode(e);e.previousElementSibling&&e.previousElementSibling.innerHTML===String.fromCharCode(8203)&&(e=e.previousElementSibling,e.nextElementSibling.remove());n(e);s=this.m_oDocument.createRange();e.innerHTML==="\u200b"?(s.selectNodeContents(e),s.collapse()):(s.selectNode(e),s.collapse());h.removeAllRanges();h.addRange(s);this._ActiveEcoute_SelectionChanged();return}f=!0;r=a()}else u.startContainer===u.endContainer&&u.endContainer==u.commonAncestorContainer?(u.startOffset===0&&u.endOffset===u.commonAncestorContainer.length&&u.commonAncestorContainer.nodeType==Node.ELEMENT_NODE&&(f=!0),r=a()):u.startOffset===0&&u.commonAncestorContainer.firstChild===u.startContainer&&u.commonAncestorContainer.lastChild===u.endContainer&&u.endContainer.length===u.endOffset&&u.commonAncestorContainer.nodeType==Node.ELEMENT_NODE?(f=!0,r=a()):r=u.commonAncestorContainer||r;f&&r===this.m_oBody&&(f=!1);this._DesactiveEcoute_SelectionChanged();this.m_oBody.removeEventListener("input",this._surInputPourUndoRedo);r=$(r)[0];b=[];p=function(n){n.dataset.wdFontFamilyPrecedente=this.m_oOptions.bEnModeMail?n.face:n.style.fontFamily;b.push(n)}.bind(this);r.querySelectorAll(this.m_oOptions.bEnModeMail?"font[face]":"[style*='font-family']").forEach(p);r.matches(this.m_oOptions.bEnModeMail?"font[face]":"[style*='font-family']")&&p(r);var it=r.outerHTML,ut=r.innerHTML,l=f?r.outerHTML:r.innerHTML,rt=this.m_oBody.innerHTML,k=!1;f||(d=this.m_oDocumentElement.outerHTML,this.m_oDocument.execCommand("fontName",!1,"WINDEVFONTNAME"),k=d!==this.m_oDocumentElement.outerHTML);v=!1;this.m_oBody.querySelectorAll(this.m_oOptions.bEnModeMail?"[face*=WINDEVFONTNAME]":"[style*=WINDEVFONTNAME]").forEach(function(n){$.contains(r,n)||r===n||(v=!0)}.bind(this));v&&(r=this.m_oBody,f=!1,l=rt);y=f?[r]:r.querySelectorAll(this.m_oOptions.bEnModeMail?"[face*=WINDEVFONTNAME]":"[style*=WINDEVFONTNAME]");y.length===0&&(this.m_oOptions.bEnModeMail?r.face==="WINDEVFONTNAME":r.style.fontFamily==="WINDEVFONTNAME")&&(y=[r],l=it,f=!0);y.forEach(function(t){!t.dataset.wdFontFamilyPrecedente&&v&&t.previousElementSibling&&t.previousElementSibling.style.fontFamily.length&&(t.dataset.wdFontFamilyPrecedente=t.previousElementSibling.style.fontFamily);t.style.fontFamily=t.dataset.wdFontFamilyPrecedente?t.dataset.wdFontFamilyPrecedente:"";n(t);t.removeAttribute("data-wd-font-family-precedente")}.bind(this));this.m_oDocument.querySelectorAll("[data-wd-font-family-precedente]").forEach(function(n){this.m_oOptions.bEnModeMail?n.face=n.dataset.wdFontFamilyPrecedente:n.style.fontFamily=n.dataset.wdFontFamilyPrecedente;n.removeAttribute("data-wd-font-family-precedente")}.bind(this));this.m_oDocument.querySelectorAll(this.m_oOptions.bEnModeMail?"[face*=WINDEVFONTNAME]":"[style*=WINDEVFONTNAME]").forEach(function(n){this.m_oOptions.bEnModeMail?n.removeAttribute("face"):n.style.fontFamily=""}.bind(this));switch(this.m_eModeUndoRedo){case WDSaisieAPI.MODEUNDOREDO_NATIF:g=f?r.outerHTML:r.innerHTML;k?(this.m_oDocument.execCommand("undo",!1),f&&(r=a())):f?(r.outerHTML=l,(u.commonAncestorContainer.parentElement||u.commonAncestorContainer).querySelectorAll("*").forEach(function(n){n.outerHTML===l&&(r=n)}.bind(this))):r.innerHTML=l;s=this.m_oDocument.createRange();f?(s.setStart(r,0),s.setEnd(r,r.childNodes.length)):s.selectNodeContents(r);h.removeAllRanges();h.addRange(s);this.m_oDocument.execCommand("insertHTML",!1,g);this.restoreSelection(tt);break;case WDSaisieAPI.MODEUNDOREDO_PROGRAMME:this._surInputPourUndoRedo();this.m_oBody.addEventListener("input",this._surInputPourUndoRedo)}this._ActiveEcoute_SelectionChanged()}};WDSaisieAPI.prototype.NotifieApresModification=function(){this._surInputPourUndoRedo()};WDSaisieAPI.prototype.nGetIndiceDocumentWLDepuisIndiceNoeud=function(n,t){for(var u=this.m_oDocument.createNodeIterator(this.m_oBody,NodeFilter.SHOW_TEXT),i,r=0;i=u.nextNode();){if(i!=n){r+=i.textContent.length;continue}return r+t}return-1};WDSaisieAPI.prototype.CreateRangeDepuisIndice=function(n,t,i,r){var h;n<0&&(n=0);for(var o="",v=this.m_oDocument.createNodeIterator(i||this.m_oBody,NodeFilter.SHOW_TEXT),f,u,s,e=n,c=e+t,l,a;f=v.nextNode();){if(o+=f.textContent,!u&&o.length>n?s=u=f:u||o.length!==n||t!==0||(l=f,a=e),u&&o.length>=n+t){s=f;break}u||(e-=f.textContent.length);c-=f.textContent.length}try{r&&u.parentElement&&u.parentElement.scrollIntoView();!u&&l&&(s=u=l,c=e=a);h=this.m_oDocument.createRange();h.setStart(u,e);h.setEnd(s,c)}catch(y){}return h};WDSaisieAPI.prototype.CMD_SelectionneTexte=function(n,t,i,r){var e=this.__oGetSelection(),o=this.CreateRangeDepuisIndice(t,n.length,i,!0),f,u;e.removeAllRanges();e.addRange(o);r&&(f=this.m_oDocument.createElement("style"),f.innerHTML="::selection{ background:orange; }",u=this,u._DesactiveEcoute_SelectionChanged(),this.m_oBody.appendChild(f),setTimeout(function(){var n=function(){u._DesactiveEcoute_SelectionChanged();f.remove();u._ActiveEcoute_SelectionChanged();u.m_oDocument.removeEventListener("selectionchange",n)};this.m_oDocument.addEventListener("selectionchange",n)}.bind(this),1),u._ActiveEcoute_SelectionChanged())};WDSaisieAPI.prototype.__nGetIndiceDocumentWLDepuisIndiceBalise=function(n,t){var u;this._DesactiveEcoute_SelectionChanged();var f=this.saveSelection(),i=this.m_oDocument.createRange(),r=this.__oGetSelection();return i.setStart(this.m_oBody,0),i.setEndBefore(n),r.removeAllRanges(),r.addRange(i),u=this.m_oDocument.createElement("p"),u.insertBefore(i.cloneContents(),undefined),r.removeAllRanges(),this.restoreSelection(f),this._ActiveEcoute_SelectionChanged(),t+u.innerText.length};WDSaisieAPI.prototype.__sGetInnerTextAvecRC=function(n){for(var t="",r=this.m_oDocument.createNodeIterator(n||this.m_oBody,NodeFilter.SHOW_TEXT),i;i=r.nextNode();)t+=i.textContent;return t};WDSaisieAPI.prototype.CMD_RechercheTout=function(n,t,i,r){var u,f,e,a,v,h,s;n=n.replace(new RegExp(String.fromCharCode(160),"g")," ");var y=new RegExp(i?"(^|[^a-zA-Z0-9])"+n+"([^a-zA-Z0-9]|$)":n,"g"+(t?"i":"")),o={},p=this.m_oDocument.createNodeIterator(this.m_oBody,NodeFilter.SHOW_TEXT),c=0,l={};for(u=undefined;u=p.nextNode();c+=u.textContent.length)if(u.previousSibling||(l[u.parentElement.uuidv4||(u.parentElement.uuidv4=WDSaisieAPI.uuidv4())]=c),f=u.textContent,e=c,!u.nextSibling&&u.parentElement.innerText&&u.parentElement.uuidv4&&(e=l[u.parentElement.uuidv4],f=this.__sGetInnerTextAvecRC(u.parentElement)),f){f=f.replace(new RegExp(String.fromCharCode(160),"g")," ");a=n(f,y,i);function n(n,t,i){var r;if(n.matchAll)return eval("[... s.matchAll(reg)]");var u=n.split(t),e=n.match(t),o=[],f=0;for(r in u)r>0&&(o.push({0:e[r-1],index:f,1:i?u[r].substr(0,1):undefined}),f+=e[r-1].length),f+=u[r].length;return o}for(v in a)if((h=a[v],s=i&&h[1]!=""?h.index+1:h.index,!o[s+e])&&(o[s+e]={domBalise:u.parentElement,nIndice:s+e-l[u.parentElement.uuidv4],nIndiceDocument:s+e},r&&r===Object.values(o).length))return o.pop()}return Object.values(o)};WDSaisieAPI.prototype.CMD_Recherche=function(n,t,i,r){for(var e,s,f=[],o=this.CMD_RechercheTout(n,t,i),u=0;u<o.length;u++)if(e=o[u],s=this._nCalcTailleTexteAvantElem(e.domBalise,0)+e.nIndice,f.push(s),r&&r!=-1&&u>=r-1)break;return f.push(-1),f.toString()};WDSaisieAPI.prototype.CMD_RemplaceTout=function(n,t,r,u){var f=this.m_oDocument.designMode,h=f==="on"||f==="ON"||f===!0,s=!h,e,o;for(s&&this.Set_designMode("on"),e=this.CMD_RechercheTout(n,r,u),i=e.length-1;i>=0;i--)o=e[i],this.CMD_SelectionneTexte(n,o.nIndice,o.domBalise,!1),this.CMD_InsereHtml(t,!0);s&&this.Set_designMode("off")};WDSaisieAPI.prototype.CMD_SelectionFin=function(){var n=this.__oGetSelection();n.selectAllChildren(this.m_oBody);n.collapseToEnd()};WDSaisieAPI.prototype.CMD_SelectionTout=function(){var n=this.__oGetSelection();n.selectAllChildren(this.m_oBody)};WDSaisieAPI.prototype.saveSelection=function(){var i=this.m_oBody,t=this.__oGetSelection().getRangeAt(0),n=t.cloneRange();return{range:n,nIndiceDocumentDebut:this.nGetIndiceDocumentWLDepuisIndiceNoeud(n.startContainer,n.startOffset),nIndiceDocumentFin:this.nGetIndiceDocumentWLDepuisIndiceNoeud(n.endContainer,n.endOffset)}};WDSaisieAPI.prototype.restoreSelection=function(n){var i=this.CreateRangeDepuisIndice(n.nIndiceDocumentDebut,n.nIndiceDocumentFin-n.nIndiceDocumentDebut),t=this.__oGetSelection();t.removeAllRanges();t.addRange(i)};WDSaisieAPI.prototype.GetProp_Selection_JSON=function(){var n=this.GetProp_Selection();return JSON.stringify(n)};WDSaisieAPI.prototype.GetProp_SelectionSimplifiee=function(){var n=this.GetProp_Selection();let t=JSON.stringify(n);return String(n.debut)+";"+String(n.fin)};WDSaisieAPI.prototype.bEstGras=function(n){if(isNaN(n))switch(n){case"lighter":case"normal":return!1;case"bold":case"bolder":return!0;default:return!1}var t=parseInt(n,10);return t>400};const EActionVisite={stop:"1",frereSuivant:"2",premierFils:"3",frereParent:"4"};WDSaisieAPI.prototype.visisteElementDOM=function(n,t,i){if(n&&n!=t){let r=n,u=r.nextSibling;while(r){var f=i(r);switch(f){case EActionVisite.stop:return;case EActionVisite.frereSuivant:u=r.nextSibling;break;case EActionVisite.premierFils:u=r.firstChild;break;case EActionVisite.frereParent:if(!r.parentNode)return;u=r.parentNode.nextSibling}if(r==t)return;r=u}}};WDSaisieAPI.prototype.visisteElementPrincipauxEntre=function(n,t,i){this.visisteElementDOM(n,t,function(r){return r.contains(t)?EActionVisite.premierFils:(r!=n&&r!=t&&i(r),!r.nextSibling)?EActionVisite.frereParent:EActionVisite.frereSuivant}.bind(this))};WDSaisieAPI.prototype.visitePourStyle=function(n,t,i){i(n);this.visisteElementDOM(n,t,function(r){return r.contains(t)?EActionVisite.premierFils:(r!=n&&i(r),!r.nextSibling)?EActionVisite.frereParent:EActionVisite.frereSuivant}.bind(this))};WDSaisieAPI.prototype._nCalcTailleTexteAvantElem=function(n,t,i){var h,f,a,u;i===undefined&&(i=!0);let e=this.m_oBody;while(e.firstChild)e=e.firstChild;var r=t,c=!1,l=!1,o=!1;n.nodeName==="#text"&&r===0&&n.textContent!==""&&n.parentElement&&n.parentElement.nodeName==="DIV"&&n.parentElement.previousSibling&&(n.parentElement.previousSibling.nodeName=="#text"||n.parentElement.previousSibling.nodeName=="DIV")?l=!0:n.nodeName==="#text"&&r>0&&r-1<n.textContent.length-1&&n.textContent[r-1]===" "&&(c=!0);n.nodeName==="#text"&&r===0&&n.textContent.length>0&&(o=!0,r++);n.nodeName==="#text"&&r===1&&n.textContent.length>1&&n.textContent[0]==="\n"&&(o=!0,r++);let s=this.m_oDocument.createRange();return s.setStart(e,0),s.setEnd(n,r),documentFragment=s.cloneContents(),i&&this._DesactiveEcoute_SelectionChanged(),h=this.m_oBody,f=this.m_oDocument.createElement("div"),f.appendChild(documentFragment),h.appendChild(f),a=f.innerText,u=a.length,c&&u++,l&&u++,o&&u>0&&u--,h.removeChild(f),i&&this._ActiveEcoute_SelectionChanged(),u-t};WDSaisieAPI.prototype._oCalcElemeFromPos=function(n){var t={elem:this.m_oBody,offsetDansElem:0,bTrouve:!1},i;return elementDebut=this.m_oBody.firstChild,this._DesactiveEcoute_SelectionChanged(),i=0,this.visisteElementDOM(elementDebut,null,function(r){var u=0,f=0,o,s,l,h,a;if(r.innerText)u=r.innerText.length;else if(r.nodeName==="BR")u++;else if(r.nodeName==="#text"&&r.parentElement&&r.parentElement.nodeName!="STYLE")if(o=r.textContent.length,i+o+2<n)u=o;else{var v=r.cloneNode(),c=r.parentElement,e=this.m_oDocument.createElement("div");e.appendChild(v);c.appendChild(e);s=e.innerText;c.removeChild(e);u=s.length;f=r.textContent.indexOf(s);f<0&&(f=0)}return(i+u+2>=n-2&&(l=this._nCalcTailleTexteAvantElem(r,0,!1),i=l),i+u>=n)?(t.elem=r,t.offsetDansElem=u,t.bTrouve=!0,i===n)?(t.elem=r,t.offsetDansElem=0,t.bTrouve=!0,EActionVisite.stop):(h=i+u==n,r.firstChild&&this._nCalcTailleTexteAvantElem(r.firstChild,0)!=i&&(h=!1),h)?(t.elem=r,t.offsetDansElem=r.nodeName=="#text"?u+f:r.childNodes.length,t.bTrouve=!0,EActionVisite.stop):r.firstChild?EActionVisite.premierFils:(t.elem=r,t.offsetDansElem=n-i+f,t.offsetDansElem>u+f&&(t.offsetDansElem=u+f),t.offsetDansElem<0&&(t.offsetDansElem=0),t.bTrouve=!0,a=this._nCalcTailleTexteAvantElem(t.elem,t.offsetDansElem)+t.offsetDansElem,a===n-1&&t.offsetDansElem++,EActionVisite.stop):(i+=u,!r.nextSibling)?EActionVisite.frereParent:EActionVisite.frereSuivant}.bind(this)),this._ActiveEcoute_SelectionChanged(),t};WDSaisieAPI.prototype.CMD_Selectionne=function(n,t){var f,e;this._DesactiveEcoute_SelectionChanged();try{var o=this.__oGetSelection(),i=this.m_oDocument.createRange(),r=this._oCalcElemeFromPos(n),u=this._oCalcElemeFromPos(t);i.selectNodeContents(r.elem);f=i.endOffset;r.bTrouve||(r.offsetDansElem=n<1?0:f);i.selectNodeContents(u.elem);e=i.endOffset;u.bTrouve||(u.offsetDansElem=t<1?0:e);i.setStart(r.elem,Math.min(f,r.offsetDansElem));i.setEnd(u.elem,Math.min(e,u.offsetDansElem));o.removeAllRanges();o.addRange(i)}catch(s){}this._ActiveEcoute_SelectionChanged()};WDSaisieAPI.prototype.CorrigeSelectionMot=function(){var t=this.__oGetSelection(),n,r,i;(t.type!="None"&&(n=t.getRangeAt(0),r=n.commonAncestorContainer),n)&&(i=t.toString(),i.slice(-1)==" "&&n.endOffset>0&&n.setEnd(n.endContainer,n.endOffset-1))};WDSaisieAPI.prototype.GetProp_Selection=function(n){function h(n,i,r){i===undefined&&(i=0);r===undefined&&(r=-1);let u={html:""};u.texte=n.textContent;n.outerHTML?u.html=n.outerHTML:n.innerHTML&&(u.html=n.innerHTML);u.debut=i;u.fin=r==-1?u.texte.length:r;t.fragment.push(u)}var t={},e,i,f,u,s,r,l;this._DesactiveEcoute_SelectionChanged();e=this.__oGetSelection();e.type!="None"&&(i=e.getRangeAt(0),f=i.commonAncestorContainer);let o=!0;if(i&&(o=i.startContainer==i.endContainer),f&&(u=this.oGetCurrentStyle(f,!0)),t.type=0,e.type=="None"&&(t.type=-1),e.type=="Caret"&&(t.type=0),e.type=="Range"&&(t.type=e.rangeCount>1?2:1),t.texte=e.toString(),t.html="",f&&t.type>=1&&(f.outerHTML&&!s?t.html=f.outerHTML:f.innerHTML?t.html=f.innerHTML:f.nodeName=="#text"&&(t.html=f.parentNode.innerHTML),s=e.containsNode(this.m_oBody),s&&(t.html=this.m_oBody.outerHTML)),i&&!n){let n=this._nCalcTailleTexteAvantElem(i.startContainer,i.startOffset);t.debut=n+i.startOffset;t.fin=t.debut+t.texte.length}else t.debut=0,t.fin=0;if(t.style={nom:""},t.style.police={gras:!1,italique:!1,souligne:!1,barre:!1,indice:!1,exposant:!1,alignement:0,couleur:-1,couleurFond:-1,opaciteCouleurFond:0,nom:"",taille:""},u&&u.textDecorationLine)for(t.style.police.gras=this.bEstGras(u.fontWeight),t.style.police.italique=u.fontStyle=="italic"||u.fontStyle=="oblique",t.style.police.souligne=u.textDecorationLine.includes("underline"),t.style.police.barre=u.textDecorationLine.includes("line-through"),t.style.police.barre&&(t.style.police.souligne=this.m_oDocument.queryCommandState("underline")),t.style.police.indice=u.verticalAlign.includes("sub"),t.style.police.exposant=u.verticalAlign.includes("super"),t.style.police.alignement=0,u.textAlign=="center"&&(t.style.police.alignement=1),u.textAlign=="right"&&(t.style.police.alignement=2),t.style.police.couleur=this._nCouleurJSversWin32(u.color),t.style.police.couleurFond=this._nCouleurJSversWin32(u.backgroundColor),t.style.police.opaciteCouleurFond=this._nGetAlphaColor(u.backgroundColor),t.style.police.nom=u.fontFamily,t.style.police.taille=u.fontSize,this.visitePourStyle(i.startContainer,i.endContainer,function(n){var i=this.oGetCurrentStyle(n);i.textAlign!=u.textAlign&&(t.style.police.alignement=-1);i.color!=u.color&&(t.style.police.couleur=-1);i.backgroundColor!=u.backgroundColor&&(t.style.police.couleurFond=-1,t.style.police.opaciteCouleurFond=0);i.fontFamily!=u.fontFamily&&(t.style.police.nom="");i.fontSize!=u.fontSize&&(t.style.police.taille="")}.bind(this)),t.style.nom="",i&&(r=i.startContainer);r;){if(r.tagName=="H1"||r.tagName=="H2"||r.tagName=="H3"||r.tagName=="H4"||r.tagName=="H5"||r.tagName=="H6"){t.style.nom=r.tagName;break}if((r.tagName=="SPAN"||r.tagName=="P"||r.tagName=="DIV")&&r.className&&r.className!="undefined"){t.style.nom=r.className;break}r=r.parentElement}if(t.URL="",i)for(r=i.startContainer;r;)r.tagName=="A"&&(t.URL=r.href),r=r.parentElement;t.fragment=[];l=i?i.startContainer:undefined;let c=-1;return o&&i&&(c=i.endOffset),i&&(h(i.startContainer,i.startOffset,c),o||(this.visisteElementPrincipauxEntre(i.startContainer,i.endContainer,function(n){h(n)}.bind(this)),h(i.endContainer,0,i.endOffset))),this._ActiveEcoute_SelectionChanged(),t};WDSaisieAPI.prototype.CMD_InsereHtml=function(n,t){this.m_sDerniereValeurHtmlAffectee=undefined;this._DesactiveEcoute_SelectionChanged();this.m_oBody.removeEventListener("input",this._surInputGestionLien);this.m_oDocument.execCommand(t?"insertText":"insertHTML",!1,n);this.m_oBody.addEventListener("input",this._surInputGestionLien);this._ActiveEcoute_SelectionChanged()};WDSaisieAPI.prototype.CMD_ForceStyleH=function(n){var t=this.__oGetSelection(),i=t.toString(),f,r,u,e;i!=""||t.type=="None"||this.bSelectionEstALaFin(t)||(f=t.getRangeAt(0),r=f.commonAncestorContainer,r.nodeName=="#text"&&(u=this.m_oDocument.createRange(),u.selectNode(r),t.removeAllRanges(),t.addRange(u)),i=t.toString());i==""&&(i="\u200b");e="<"+n+">"+i+"<\/"+n+">";this.CMD_InsereHtml(e)};WDSaisieAPI.prototype.CMD_ChangeNomStyleCss=function(n){this.CMD_ChangeStyle(function(t){t.className=n}.bind(this))};WDSaisieAPI.prototype.CMD_SupprimeCouleurTexte=function(){this.CMD_ChangeStyle(function(n){$(n).css("color","")}.bind(this))};WDSaisieAPI.prototype.CMD_SupprimeCouleurFond=function(){this.CMD_ChangeStyle(function(n){$(n).css("background-color","")}.bind(this))};WDSaisieAPI.prototype.oGetHxParent=function(n){for(n.nodeName=="#text"&&(n=n.parentNode);n;){if(n.tagName=="H1"||n.tagName=="H2"||n.tagName=="H3"||n.tagName=="H4"||n.tagName=="H5"||n.tagName=="H6")return n;n=n.parentElement}return null};WDSaisieAPI.prototype.CMD_SupprimeStyleCss=function(){var n=this.__oGetSelection(),i,t,f,r,u;if(n.type!="None"&&(range_0=n.getRangeAt(0),i=range_0.commonAncestorContainer),n=this.__oGetSelection(),i&&(t=this.oGetHxParent(i)),t){f=this.m_oDocument.createRange();r=t.innerHTML;t.outerHTML=r;return}u=n.toString();this.CMD_InsereHtml(u)};WDSaisieAPI.prototype.GetProp_Document_JSON=function(){var n={};n.texte=this.m_oDocumentElement.innerText;n.html=this.m_oDocumentElement.outerHTML;return JSON.stringify(n)};WDSaisieAPI.prototype._nCouleurJSversWin32=function(n){if(!n)return-1;var t=n.replace(/[^\d,]/g,"").split(",");return(t.length=3)?parseInt(t[0])+parseInt(t[1])*256+parseInt(t[2])*65536:(t.length=4)?parseInt(t[1])+parseInt(t[2])*256+parseInt(t[3])*65536:-1};WDSaisieAPI.prototype._nGetAlphaColor=function(n){var t=n.replace(/[^\d,]/g,"").split(",");return t.length<4?255:parseInt(t[0])};WDSaisieAPI.prototype.GetListeTousLesStyles=function(){function k(n){return n.replace(/(\-[a-z])/g,function(n){return n.toUpperCase().replace("-","")})}for(var r,u,w,a,s,y,o,e,p,c,t,i,f,n={tabNomClass:[],"class":{},tabNomTag:[],tag:{}},l=0;l<this.m_oDocument.styleSheets.length;++l)if(r=this.m_oDocument.styleSheets[l],!this.m_tabBaliseCssAjoutee.filter(function(n){return n===r.ownerNode}.bind(this)).length)try{for(u=0;u<r.cssRules.length;++u)if(!(!r.cssRules[u]instanceof CSSStyleRule)&&r.cssRules[u].selectorText)for(w=r.cssRules[u].selectorText.trim(),a=w.split(","),s=0;s<a.length;++s){var v=a[s].trim(),h=v.toLowerCase(),b=!1;["h1","h2","h3","h4","h5","h6","p"].forEach(function(n){n==h&&(b=!0)});b?(n.tag[h]||n.tabNomTag.push(h),n.tag[h]=r.cssRules[u]):v.indexOf(".")===0&&(y=v.substr(1).split(/[^A-Za-z0-9\-\_]+/g),o=y[0],n.class[o]&&y.length!==1||(n.class[o]||n.tabNomClass.push(o),n.class[o]=r.cssRules[u]))}}catch(d){continue}e=$("<span style='visibility:hidden;position:fixed;top:-999999px;left:-999999px;'/>");$(this.m_oBody).append(e);p=$.extend({},this.m_oWindow.getComputedStyle(e[0]));for(sClass in n.class)for(e.attr("class",sClass),t=this.m_oWindow.getComputedStyle(e[0]),n.class[sClass]={style:{}},i=0;i<t.length;++i)(f=k(t[i]),p[f]!==t[f])&&(n.class[sClass].style[t[i]]=t[f]);e.remove();for(sTagNom in n.tag){for(c=$("<"+sTagNom+" style='visibility:hidden;position:fixed;top:-999999px;left:-999999px;'/>"),$(this.m_oBody).append(c),t=this.m_oWindow.getComputedStyle(c[0]),n.tag[sTagNom]={style:{}},i=0;i<t.length;++i)(f=k(t[i]),p[f]!==t[f])&&(n.tag[sTagNom].style[t[i]]=t[f]);c.remove()}return JSON.stringify(n)};WDSaisieAPI.prototype.Get_UndoRedoStatus=function(){var n={};n.undoOk=this._bUndoPossible();n.redoOk=this._bRedoPossible();return JSON.stringify(n)};WDSaisieAPI.prototype.bSelectionEstALaFin=function(n){if(!this.m_oBody.lastChild)return!0;if(!n.isCollapsed||n.type=="None"||n.containsNode(this.m_oBody.lastChild))return!1;range_0=n.getRangeAt(0);selParent=range_0.commonAncestorContainer;var t=range_0.endContainer;return(t.nodeName=="#text"&&(t=t.parentNode),nLen=t.innerText.length,range_0.endOffset<nLen)?!1:!0};WDSaisieAPI.prototype.sGetWLEXEC=function(n){var t=n;try{t=eval(n)}catch(i){return n}return t};WDSaisieAPI.prototype.sGetTraduction=function(n,t){if(!window.HTML_TOOLBAR)return n;var i;try{i=eval(n)}catch(r){return n}return t!==undefined?i[t]:i};WDSaisieAPI.prototype.CreerRangeSelectionTexteSurBaliseCible=function(n,t){var r,u,i;if(n)return r=this.m_oDocument.createRange(),u=this.__oGetSelection(),n.tagName.toLowerCase()==="img"?r.selectNode(n):r.selectNodeContents(n),u.removeAllRanges(),t&&(this.m_domStyleSelectionTransparent||(this.m_domStyleSelectionTransparent=this.m_oDocument.createElement("style"),this.m_domStyleSelectionTransparent.innerHTML="::selection{ background:transparent; }"),i=this,i._DesactiveEcoute_SelectionChanged(),this.m_oBody.appendChild(this.m_domStyleSelectionTransparent),setTimeout(function(){var n=function(){i._DesactiveEcoute_SelectionChanged();this.m_domStyleSelectionTransparent.remove();i._ActiveEcoute_SelectionChanged();i.m_oDocument.removeEventListener("selectionchange",n);this.m_oBody.removeEventListener("blur",n)}.bind(this);this.m_oDocument.addEventListener("selectionchange",n);this.m_oBody.addEventListener("blur",n)}.bind(this),1),i._ActiveEcoute_SelectionChanged()),u.addRange(r),r};WDSaisieAPI.prototype.JSEXEC_ElementCourant=function(n,t){var r,i;if(this.m_oElementCourant&&this.m_oElementCourant[n]){for(r=[],i=1;i<arguments.length;++i)r.push(arguments[i]);if(!t||!t.id||!this.m_oElementCourant.id||this.m_oElementCourant.id===t.id)return this.m_oElementCourant[n].apply(this,r)}};WDSaisieAPI.prototype.CMD_InsereTableauHTML=function(n,t){n=n.replace("<table ",'<table data-wbtableauhtml="true" ');this.CMD_InsereHtml(n);setTimeout(function(){var n=$(this.m_oBody),u=n.find("[data-wbtableauhtml]").removeAttr("data-wbtableauhtml"),i=u.find("td").first(),r;this.CreerRangeSelectionTexteSurBaliseCible(i.get(0));n.trigger("trigger.wb.saisieriche.selectionne",i);t&&(r=n.find("#wbSaisieRicheBarreTable"),r.children().last().trigger("click.wb.saisieriche.barretable"))}.bind(this),10)};WDSaisieAPI.prototype.__InitGestionJS=function(){function tt(n){return $.extend({},n[0].getBoundingClientRect(),{left:n.offset().left+parseInt(getComputedStyle(n[0]).borderLeftWidth),top:n.offset().top+parseInt(getComputedStyle(n[0]).borderTopWidth),width:n[0].clientWidth||n[0].offsetWidth,height:n[0].clientHeight||n[0].offsetHeight,transform:n[0].style.transform,marginTop:parseFloat(n[0].style.marginTop||0),marginRight:n[0].style.marginRight=="auto"?0:parseFloat(n[0].style.marginRight||0),marginBottom:parseFloat(n[0].style.marginBottom||0),marginLeft:n[0].style.marginLeft=="auto"?0:parseFloat(n[0].style.marginLeft||0)})}function gt(n,t,i){(i||n.attr)&&k.forEach(function(r){(!i||t[0].hasAttribute(r))&&(i?(n||(n={}),n.attr||(n.attr={}),n.attr[r]=t.attr(r)):t.attr(r,n.attr[r]))})}function ni(n,t,i){var u,r;if(i)for(u=0;u<t[0].style.length;++u)n.style||(n.style={}),r=t[0].style[u],n.style[r]=t[0].style[jQuery.camelCase(r)];else{if(!n.style)return;for(r in n.style)t.css(r,n.style[r])}}function it(n,t,i){gt(n,t,i);ni(n,t,i)}function ti(n,t,i){var u=$('<div class="wbSaisieRicheModalGFI" contenteditable="false"><\/div>'),a=$('<div class="wbSaisieRicheModal"><\/div>'),f,e,v,c,l,r,o,s,h;return u.append(a),f=$('<div class="wbSaisieRicheModalContenu"><\/div>'),a.append(f),e=$('<div class="wbSaisieRicheModalContenuEntete"><\/div>'),f.append(e),v=$('<h5 class="wbSaisieRicheModalContenuTitre">'+t[0].tagName+"<\/h5>"),e.append(v),c=$('<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">\u00d7<\/span><\/button>'),c.click(function(){u.remove()}),e.append(c),l=$('<div class="wbSaisieRicheModalContenuCorps"><\/div>'),f.append(l),r=$("<dl><\/dl>"),l.append(r),o=$('<div class="wbSaisieRicheModalContenuPied"><\/div>'),f.append(o),s=$('<button type="button" class="wbSaisieRicheModalBoutonAnnuler" data-dismiss="modal">Annuler<\/button><\/div>'),s.click(function(){u.remove()}),o.append(s),h=$('<button type="button" class="wbSaisieRicheModalBoutonOK">OK<\/button>          <\/div>'),h.click(function(){n(i);u.remove()}),o.append(h),$(window.document.body).append(u),{Annuler:function(){s.click()},OK:function(){h.click()},RAZ:function(n){i=n;r.empty()},ajoutePerso:function(n){n(r)},ajouteChampFormulaire:function(n,t,i,u,f){var o=u?"attr":"style",e=t[o][i]||"",s,l,h,c;f||(f=typeof e=="number"?"range":"text");f==="range"||f==="number"?e=e?parseFloat(e):0:f==="color"&&(s=clWDUtil.tabHTML2RVBA(e),e="#"+s[0].toString(16).padStart(2,"0")+s[1].toString(16).padStart(2,"0")+s[2].toString(16).padStart(2,"0"));l=$("<dt>"+n+"<\/dt>");r.append(l);h=$("<dd><\/dd>");r.append(h);c=$('<input type="'+f+'" value="'+e+'" title="'+e+'"/>');c.on("change",function(){t[o][i]=this.value;(f==="range"||f==="number")&&(t[o][i]+="px");this.title=t[o][i]});h.append(c)},ajouteAttrStyle:function(n){this.ajouteAttr(n);this.ajouteStyle(n)},ajouteAttr:function(n){n.attr&&k.forEach(function(t,i){this.ajouteChampFormulaire(k[i],n,k[i],!0)}.bind(this))},ajouteStyle:function(n){n.style&&(this.ajouteChampFormulaire("Couleur de fond",n,"background-color",!1,"color"),this.ajouteChampFormulaireBordures(n))},ajouteChampFormulaireBorduresCote:function(n,t){this.ajouteChampFormulaire("Epaisseur de bordure "+t,n,"border-"+t+"-width",!1,"range");this.ajouteChampFormulaire("Style de bordure "+t,n,"border-"+t+"-style",!1,"text");this.ajouteChampFormulaire("Couleur de bordure "+t,n,"border-"+t+"-color",!1,"color")},ajouteChampFormulaireBordures:function(n){this.ajouteChampFormulaireBorduresCote(n,"top");this.ajouteChampFormulaireBorduresCote(n,"right");this.ajouteChampFormulaireBorduresCote(n,"bottom");this.ajouteChampFormulaireBorduresCote(n,"left")}}}function vt(i,r){function o(n,t,i,r){t.selectNodeContents(i);t.collapse(!r)}function c(n,t){var i=t===undefined;return t||(t={id:WDSaisieAPI.uuidv4(),table:{tr:[]}}),t&&t.reset&&n.attr("style","").add(n.children("tbody,thead,tfoot")).children("tr").each(function(){var n=$(this);n.children("td,th").each(function(){this.style=""})}),it(t.table,n,i),n.add(n.children("tbody,thead,tfoot")).children("tr").each(function(n){var f=$(this),r=n<t.table.tr.length?t.table.tr[n]:t.table.tr[t.table.tr.push({td:[]})-1];it(r,f,i);f.children("td,th").each(function(n){var t=n<r.td.length?r.td[n]:r.td[r.td.push({})-1];i&&this===u[0]&&(t.focus=!0);it(t,$(this),i)})}),i?JSON.stringify(t):!0}function p(t,i){try{var r=JSON.parse(i)}catch(u){return}r.table&&n.ExecuteEditeurImage(function(){var i=window.wbEditeurTableauHTML({TraiteTable:c,jsonTable:r,bEnModeMail:n.m_oOptions.bEnModeMail,sModeEditionCourant:t,onOK:function(t){t&&(n.m_oElementCourant[n.sGetWLEXEC("JSEXEC_ELEMENTCOURANT_WRITETABLE")](t),n.NotifieApresModification(),n.m_oDocument.body.focus())},onComponentDidMount:function(){setTimeout(function(){$(i).hide().fadeIn().focus()},10)}});n.m_oDocument.documentElement.wdSaisieRiche.RafBarre(undefined,!1)}.bind(n),function(){alert(tabWDErrors[0])}.bind(n))}function v(n,t){if(n.hasAttributes())for(var i=n.attributes.length-1;i>=0;i--)t.setAttribute(n.attributes[i].name,n.attributes[i].value)}function y(n){var e=0,i,t,r;for(f.find("tr").first().children("td").each(function(){e+=parseInt(this.getAttribute("colspan")||1)}),i=f[0].insertRow(u.parent().index()+(n?0:1)),t=0;t<e;++t)r=i.insertCell(t),r.innerHTML="<br />",v(u.get(0),r);return i}var f,u,l,a;if(i&&i.length){if(!n.m_oOptions.bGestionTables)return}else return;if(f=i.closest("table"),!f.find("[rowspan]").length){u=i;f.addClass("wbSaisieRicheTableSelectionne");f.find("td").removeClass("wbSaisieRicheTdSelectionne");u.addClass("wbSaisieRicheTdSelectionne");l=tt(u);a=function(t){var p,w,s,a,v,b,c;if(u&&u.length){var r=!1,i=n.__oGetSelection(),e=i.getRangeAt(0),h=e.cloneRange();if(h.selectNodeContents(u[0]),h.setEnd(e.startContainer,e.startOffset),p=h.toString()=="",h.selectNodeContents(u[0]),h.setStart(e.endContainer,e.endOffset),w=h.toString()=="",(r=t.ctrlKey&&t.key==="a")?n.CreerRangeSelectionTexteSurBaliseCible(u[0]):i.rangeCount>0&&(s=i.getRangeAt(0),$.contains(f[0],s.commonAncestorContainer)&&((r=t.key==="Tab"&&!t.ctrlKey)?(a=!1,v=undefined,u[0]!=f.add(f.children("tbody")).children("tr").children("td").each(function(){if(a)return o(i,s,this),!1;if(this===u[0]){if(t.shiftKey)return o(i,s,v),!1;a=!0}v=this}).last().get(0)||t.shiftKey||(b=y(!1),o(i,s,b.firstElementChild))):(r=w&&t.key==="ArrowDown"&&i.focusNode&&u[0].parentElement&&u[0].parentElement.nextElementSibling)?(c=u.index(),o(i,s,u[0].parentElement.nextElementSibling.children[c])):(r=p&&t.key==="ArrowUp"&&i.focusNode&&u[0].parentElement&&u[0].parentElement.previousElementSibling)&&(c=u.index(),o(i,s,u[0].parentElement.previousElementSibling.children[c],!0)))),!r){var l=!1,k=!1,d=i.focusNode.nodeType===Node.TEXT_NODE;t.key==="ArrowDown"&&(!d||u[0].lastChild.contains(i.focusNode))?k=!0:t.key==="ArrowUp"&&(!d||u[0].childNodes[0].contains(i.focusNode))&&(l=!0);(l||k)&&(e.selectNode(l?u[0].firstChild:u[0].lastChild),e.collapse(l),r=!0)}r&&(t.stopPropagation(),t.preventDefault())}};t.on("keydown.wb.saisieriche.barretable",a);n.m_oElementCourant={};n.m_oElementCourant[n.sGetWLEXEC("JSEXEC_ELEMENTCOURANT_READTABLE")]=function(){return c(f)};n.m_oElementCourant[n.sGetWLEXEC("JSEXEC_ELEMENTCOURANT_WRITETABLE")]=function(t,i){try{var r=typeof t=="object"?t:JSON.parse(t)}catch(u){return!1}return i?n.EmpileUndoRedo(f,function(){return c(f,r)}.bind(this)):c(f,r)};s.children().each(function(){$(this).on("click.wb.saisieriche.barretable",function(i){if(u&&u.length){i.stopPropagation();i.preventDefault();t.trigger("trigger.wb.saisieriche.deselectionneTout");var r=h[$(this).index()];n.EmpileUndoRedo(f,function(){var i=!1,s,o;switch(r.action){case"ROW.BEFORE":i=!0;case"ROW.AFTER":y(i);break;case"ROW.DELETE":o=u.parent().index();u=u.parent().siblings().first().children().eq(u.index());f[0].deleteRow(o);break;case"COLUMN.BEFORE":i=!0;case"COLUMN.AFTER":s=u.index()+(i?0:1);f.find("tr").each(function(){v(u.get(0),this.insertCell(s))});break;case"COLUMN.DELETE":o=u.index();u=u.next().add(u.siblings().first()).last();f.find("tr").each(function(){this.deleteCell(o)});break;case"WLEXEC":return(!e.WL||n.m_bModeWeb||r.bForceModeWeb?p:e.WL.Execute)(r.param,c(f)),t.trigger("trigger.wb.saisieriche.deselectionneTout"),!1;default:return!1}return u.addClass("wbSaisieRicheTdSelectionne"),t.trigger("trigger.wb.saisieriche.deselectionneTout"),!0}.bind(this),function(i,r){return(u=r.find(".wbSaisieRicheTdSelectionne"),u.removeClass("wbSaisieRicheTdSelectionne"),!i)?(t.trigger("trigger.wb.saisieriche.deselectionneTout"),!1):(n.NotifieApresModification(),vt(u),!0)}.bind(this))}})});ft(l,s,undefined,!0,r)}}function ii(i,r){var f,u,e;if(t[0].parentElement.wdSaisieRiche){if(f=t[0].parentElement.wdSaisieRiche.oGetElementByIdBarre(parent.document,"LNK"),f&&!clWDUtil.bEstDisplay(f,parent.document))return}else if(!n.m_oOptions.bGestionLiens){r.ctrlKey&&window.WL&&WL.Execute(n.sGetWLEXEC("WLEXEC_CLICLIEN"),i[0].href);return}i.addClass("wbSaisieRicheLienSelectionne");u=i;e=tt(i);l.children().each(function(){$(this).on("click.wb.saisieriche.barrelien",function(i){if(u&&u.length){i.stopPropagation();i.preventDefault();t.trigger("trigger.wb.saisieriche.deselectionneTout");var r=b[$(this).index()];r.fAction&&n.EmpileUndoRedo(u,function(){return r.fAction(u)}.bind(this),function(n,i){t.trigger("trigger.wb.saisieriche.deselectionneTout");n&&setTimeout(function(){t.trigger("trigger.wb.saisieriche.selectionne",i)},100)}.bind(this))}})});ft(e,l)}function yt(n,t){t&&t[0]&&(["top","right","bottom","left"].forEach(function(t){var i="margin"+t[0].toUpperCase()+t.substr(1),u=n[i];r.css("border-"+t+"-width",u).css(i,-u)}),rt.css("marginTop",-n.marginTop).finish().fadeIn(),g.css("marginLeft",n.marginRight).finish().fadeIn(),nt.css("marginLeft",-n.marginLeft).finish().fadeIn(),ut.css("marginTop",n.marginBottom).finish().fadeIn(),(t[0].style.width=="100%"||t[0].style.margin.indexOf("auto")>-1)&&(g.finish().fadeOut(),nt.finish().fadeOut()))}function pt(i,r,f){n._DesactiveEcoute_SelectionChanged();t.find(".wbSaisieRicheWrapperSelection").length||(t.append(u),u.css({width:i.width,height:i.height,top:i.top,left:i.left,transform:i.transform,transformOrigin:i.transformOrigin}),f&&u.css({height:0}),yt(i,r));n._ActiveEcoute_SelectionChanged()}function wt(t,i,r,f){pt(t,r,f);n._DesactiveEcoute_SelectionChanged();u.append(i);n._ActiveEcoute_SelectionChanged()}function d(t,i){i&&i.effect&&i.effect("shake",{distance:5},250);n.sGetTraduction("HTML_TOOLBAR.DLG.ERR")&&alert(n.sGetTraduction("HTML_TOOLBAR.DLG.ERR"))}function ft(i,r,f,e,o){var h=r.data("wbSaisieRicheMiniBarreUpdateTimeout"),s;h&&clearTimeout(h);s=function(){pt(i,f,e);n._DesactiveEcoute_SelectionChanged();u.append(r);n._ActiveEcoute_SelectionChanged();r.removeClass("wbSaisieRicheMiniBarreEnDessous");var o={top:-i.marginTop,left:0,marginTop:"",marginLeft:i.width/2-r.width()/2,transform:i.transform.split("rad").map(function(n){return n.split("rotateZ(")[1]}).map(function(n){return n?"rotateZ("+-1*parseFloat(n)+"rad)":""}).join(" ")};i.top-i.marginTop<r.height()+5&&(o.top=i.height+r.height(),o.marginTop="calc(-1.5rem + 3px)",r.addClass("wbSaisieRicheMiniBarreEnDessous"));i.left+o.marginLeft<0?o.marginLeft=0:i.left+o.marginLeft+r.width()>t.width()&&(o.left=-r.width()+i.width,o.marginLeft=0);r.css(o)};o&&(o.type==="input"||o.type==="DOMCharacterDataModified")?r.data("wbSaisieRicheMiniBarreUpdateTimeout",setTimeout(s,100)):s()}function ri(f){function kt(t,i){var r,u;try{r=JSON.parse(i)}catch(f){return}r.img&&(u=ti(n.m_oElementCourant[n.sGetWLEXEC("JSEXEC_ELEMENTCOURANT_WRITEIMG")],s,r),u.ajouteAttrStyle(r.img))}function ot(n,t){var i=t===undefined;return t||(t={id:WDSaisieAPI.uuidv4(),img:{}}),it(t.img,n,i),i?JSON.stringify(t):!0}var et,h,ut;if(!t[0].parentElement.wdSaisieRiche||(et=t[0].parentElement.wdSaisieRiche.oGetElementByIdBarre(parent.document,"IMG"),!et||clWDUtil.bEstDisplay(et,parent.document))){f.addClass("wbSaisieRicheImgSelectionne");n.CreerRangeSelectionTexteSurBaliseCible(f[0],!0);h=tt(f);h.transform=f[0].style.transform;h.transformOrigin=f[0].style.transformOrigin;var nt=h.left,rt=h.top,s=f,l,w,y,st,ct,b,k,g,a,v,lt,at,vt=function(n){var i,r,e,u,f;i=n.screenX-st;r=n.screenY-ct;a=i*y[2]+b;v=r*y[3]+k;e=s.is("img")&&!n.shiftKey;e&&(Math.abs(i)>Math.abs(r)?(v=Math.round(a*g),a=Math.round(v/g)):(a=Math.round(v/g),v=Math.round(a*g)));l.css({width:a,height:v});u=y.startPos.x+i;f=y.startPos.y+r;u=u>0?u:0;f=f>0?f:0;w.css({left:u,top:f,display:"block"});w[0].innerHTML=Math.round(a)+" &times; "+Math.round(v);y[2]<0&&l[0].clientWidth<=a&&l.css("left",nt+(b-a));y[3]<0&&l[0].clientHeight<=v&&l.css("top",rt+(k-v));i=t[0].scrollWidth-lt;r=t[0].scrollHeight-at;i+r!==0&&w.css({left:u-i,top:f-r})},pt=function(){s.removeAttr("width");s.removeAttr("height");n.m_oOptions.bEnModeMail?(s.css("width",""),s.css("height",""),s.attr("width",a),s.attr("height",v)):(s.css("width",a),s.css("height",v));t.removeClass("wbSaisieRicheIframeBodyDragEnCours").css("cursor","");t.off("mousemove.wb.saisieriche.redimensionne",vt);t.off("mouseup.wb.saisieriche.redimensionne",pt);l.remove();w.remove();setTimeout(function(){t.trigger("trigger.wb.saisieriche.selectionne",s)},1)},bt=function(n,i){y=n;st=i.screenX;ct=i.screenY;b=s.width();k=s.height();g=k/b;y.startPos={x:h.width*y[0]+nt,y:h.height*y[1]+rt};lt=t[0].scrollWidth;at=t[0].scrollHeight;l=s.clone(!0);l.addClass("wbSaisieRicheImgGhost");l[0].contentEditable=!1;l[0].unSelectabe=!0;l.css({left:nt,top:rt,marginRight:0,marginBottom:0,marginTop:-parseInt(getComputedStyle(s[0]).borderTopWidth),marginLeft:-parseInt(getComputedStyle(s[0]).borderLeftWidth)});l.removeClass("wbSaisieRicheImgSelectionne");t.append(l);t.css("cursor",$(i.target).css("cursor")).addClass("wbSaisieRicheIframeBodyDragEnCours");t.on("mousemove.wb.saisieriche.redimensionne",vt);t.on("mouseup.wb.saisieriche.redimensionne",pt);t.append(w=$('<div class="wbSaisieRicheImgBulle">'+Math.round(b)+" &times; "+Math.round(k)+"<\/div>"));w.css({left:nt+b,top:rt+k})};i.not(".wbSaisieRicheTrackerMargeWrap").each(function(){$(this).one("mousedown.wb.saisieriche.redimensionne",function(n){if(n.stopPropagation(),n.preventDefault(),$(this).hasClass("wbSaisieRicheTrackerCoinShift")){var f=s.offset().left+h.width/2,e=s.offset().top+h.height/2,i=dt[n.target.id],o=Math.atan(h.height*i[1]/(h.width*i[0])),c=s[0].style.transform,r=function(){t.off("mousemove.wb.saisieriche.rotation",u);t.off("mouseup.wb.saisieriche.rotation",r);setTimeout(function(){t.trigger("trigger.wb.saisieriche.selectionne",s)},1)},u=function(n){var t=n.pageX-f,i=n.pageY-e,r=Math.atan(i/t);s[0].style.transform=c+" rotateZ("+(o+r)+"rad)"};t.on("mousemove.wb.saisieriche.rotation",u);t.on("mouseup.wb.saisieriche.rotation",r);return}bt(ht[n.target.id],n)})});r.children().each(function(){var f="margin",e="page",o=!1;switch(this.id){case"wbSaisieRicheTrackerMargeT":f+="Top";e+="Y";o=!0;break;case"wbSaisieRicheTrackerMargeR":f+="Right";e+="X";o=!1;break;case"wbSaisieRicheTrackerMargeB":f+="Bottom";e+="Y";o=!1;break;case"wbSaisieRicheTrackerMargeL":f+="Left";e+="X";o=!0}var l=undefined,c=$(),a=function(){t.off("mousemove.wb.saisieriche.margin",l);t.off("mouseup.wb.saisieriche.margin",a);s.css({marginTop:h.marginTop,marginRight:h.marginRight,marginBottom:h.marginBottom,marginLeft:h.marginLeft});c.remove();u.css("margin","");t.removeClass("wbSaisieRicheIframeBodyDragEnCours").css("cursor","");r.removeClass("wbSaisieRicheTrackerMargeMagnetismeT").removeClass("wbSaisieRicheTrackerMargeMagnetismeR").removeClass("wbSaisieRicheTrackerMargeMagnetismeB").removeClass("wbSaisieRicheTrackerMargeMagnetismeL");setTimeout(function(){t.trigger("trigger.wb.saisieriche.selectionne",s)},1)},v=$(this);v.one("click.wb.saisieriche.margin",function(n){n.stopPropagation();n.preventDefault()}).one("dblclick.wb.saisieriche.margin",function(t){t.stopPropagation();t.preventDefault();var r=t&&(t.ctrlKey||t.which==17),i=prompt(n.sGetTraduction("HTML_TOOLBAR.DLG.MRG")||"Margin ?",h[f]);i!==undefined&&(h[f]=parseFloat(i),r&&(h.marginTop=h.marginRight=h.marginBottom=h.marginLeft=h[f]),a())}).one("mousedown.wb.saisieriche.margin",function(n){n.stopPropagation();n.preventDefault();var w=n[e],b=!1,p=1,y={marginTop:h.marginTop,marginRight:h.marginRight,marginBottom:h.marginBottom,marginLeft:h.marginLeft},k={width:h.width};t.append(c=$('<div class="wbSaisieRicheImgBulle"><\/div>'));t.css("cursor",v.css("cursor")).addClass("wbSaisieRicheIframeBodyDragEnCours");majBulle=function(){var i=v.offset(),n,t;c[0].innerHTML=Math.round(h[f])+"&nbsp;px";n=i.left;t=i.top+c.height();n=n>0?n:0;t=t>0?t:0;c.css({left:n,top:t})};majBulle();c.hide().delay(150).fadeIn(150);l=function(n){var c,l,a;b||y[f]!=0||(p=1,o?n[e]>w&&(p=-1):n[e]<w&&(p=-1));var k=p*(o?-1:1),v=(n[e]-w)*k,t=10;Math.abs(v)>5&&(b=!0);h[f]=Math.max(0,y[f]+v);c=n&&(n.shiftKey||n.which==16);l=n&&(n.ctrlKey||n.which==17);!c&&Math.abs(h[f]-y[f])>t&&Math.abs(h[f])<t&&y[f]>t&&(h[f]=0);["Top","Right","Bottom","Left"].forEach(function(n){!l&&!c&&f.substr(6)!=n&&Math.abs(h[f]-y[f])>t&&Math.abs(h[f]-h["margin"+n])<t?(h[f]=h["margin"+n],r.addClass("wbSaisieRicheTrackerMargeMagnetisme"+n[0])):r.removeClass("wbSaisieRicheTrackerMargeMagnetisme"+n[0])});l&&(h.marginTop=h.marginBottom=h[f],s[0].style.width=="100%"||s[0].style.margin.indexOf("auto")>-1||(h.marginRight=h.marginLeft=h[f]));majBulle();yt(h,s);s.css({marginTop:h.marginTop,marginRight:h.marginRight,marginBottom:h.marginBottom,marginLeft:h.marginLeft});wt(h,i,s);a={marginTop:h.marginTop-y.marginTop,marginLeft:h.marginLeft-y.marginLeft};s[0].style.float=="right"&&(a.marginLeft=y.marginRight-h.marginRight);u.css(a)};t.on("mousemove.wb.saisieriche.margin",l);t.on("mouseup.wb.saisieriche.margin",a)})});wt(h,i,s);ut=function(t,i,r){if(s[0].src.indexOf("data")===0)return t(s[0].src);var u=function(r,u){var f=new Image;f.crossOrigin="anonymous";f.onload=function(){var e,r=p.createElement("canvas"),o=r.getContext("2d");r.width=s[0].width;r.height=s[0].height;o.drawImage(f,0,0,r.width,r.height);try{e=r.toDataURL()}catch(h){u(h);return}if(e&&e.length){if(i)return t(e);if(!confirm(n.sGetTraduction("HTML_TOOLBAR.DLG.CPY")||"Continue ?"))return!1;s[0].src=e;t(s[0].src)}};f.onerror=function(n){u(n)};f.src=s[0].src};u(!0,function(){u(!1,function(n){r?r():d(n,s)})})};c.children().each(function(){var i=function(r){var u,w,k,g,y,nt,f,l,a,b,it,v,c;if(s&&s.length){if(r&&r.stopPropagation(),r&&r.preventDefault(),u=o[$(this).index()],w=function(){var t=prompt(n.sGetTraduction("HTML_TOOLBAR.DLG.IMG")||"Image ?",s[0].src.indexOf("data")==0?"http://":s[0].src);t&&(s[0].src=t,u.height="auto",n.NotifieApresModification())},u.action&&u.action=="MODIFIER_SRC")k=function(){ut(function(){var i=e.wbEditeurImageFactory(function(i){if(i){$(s).one("load.wb.saisieriche.chargementApresEditeurImage",function(){u.height="auto";t.trigger("trigger.wb.saisieriche.selectionne",s)});s[0].src=i;n.NotifieApresModification()}},s[0].src);$(i).hide().fadeIn().focus();p.body.parentElement.wdSaisieRiche&&p.body.parentElement.wdSaisieRiche.RafBarre(undefined,!1)},!0,w)},g=function(){if(e.wbEditeurImageFactory=!1,e.WL){(!e.WL||n.m_bModeWeb?kt:e.WL.Execute)(n.sGetWLEXEC("WLEXEC_EDITIMAGE"),ot(s));n.NotifieApresModification();t.trigger("trigger.wb.saisieriche.deselectionneTout");return}w()},n.ExecuteEditeurImage(k,g);else if(u.action&&u.action=="MODIFIER_ALT"){if(y=prompt(n.sGetTraduction("HTML_TOOLBAR.DLG.ALT")||"Alt ?",s[0].alt||s[0].title),!y)return;s[0].alt=y;s[0].title=y;n.NotifieApresModification()}else{if(u.action&&u.action=="ROTATE_CLOCKWISE_COPY"){ut(function(){var e,r;try{e=-Math.PI/2;s[0].style.width=s.width();s[0].style.height=s.height();var u={w:s.height(),h:s.width()},i=new Image,f=$("<canvas>");f.attr({width:u.w,height:u.h});r=f[0].getContext("2d");i.setAttribute("crossOrigin","anonymous");i.onload=function(){var l=f[0].width/2,a=f[0].height/2,o=i.width,c=i.height;r.translate(l,a);r.rotate(-e);r.scale(s.width()/o,s.height()/c);r.drawImage(i,-o/2,-c/2,o,c);r.rotate(e);r.translate(-l,-a);s[0].src=f[0].toDataURL();t.trigger("trigger.wb.saisieriche.deselectionneTout");s.css("opacity",0).animate({width:u.w,height:u.h,opacity:1},{easing:$.ui?"easeOutExpo":"swing",duration:250,done:function(){t.trigger("trigger.wb.saisieriche.selectionne",s);s.css("opacity","")}});s[0].style.transform="";h.width=u.w;h.height=u.h;n.NotifieApresModification()};i.onerror=function(n){return d(n,s)};i.src=s[0].src}catch(o){d(o,s);s[0].style.transform=""}});return}if(u.action&&u.action=="ROTATE_CLOCKWISE")nt=s.attr("data-wbSaisieRicheImgRotate")||0,f=(parseInt(nt)+1)%4,s.attr("data-wbSaisieRicheImgRotate",f),l=parseFloat(s[0].style.width)||s.width(),a=parseFloat(s[0].style.height)||s.height(),f==1||f==3?(b=a-l,it=-b,s.css("transition","150ms transform ease-out,150ms margin ease-out").css("width",l).css("height",a).css("transformOrigin","center center").css("margin","0 "+b+"px "+it+"px 0").css("transform","translateX("+(-l/2+a/2)+"px) translateY("+(l/2-a/2)+"px) rotateZ("+-(f*Math.PI/2)+"rad)")):(f==2||f==0)&&s.css("transition","150ms transform ease-out,150ms margin ease-out").css("width",l).css("height",a).css("transformOrigin","center center").css("margin","").css("transform","translateX(0px) translateY(0px) "+(f==0?"rotateZ("+-2*Math.PI+"rad)":"rotateZ("+-Math.PI+"rad)")),f==0?setTimeout(function(){s.css("transition","").css("transform","")},200):setTimeout(function(){s.css("transition","")},200),n.NotifieApresModification();else{if(u.action&&u.action=="CROP_SRC"){ut(function(){var u,o;if(s[0].style.transform!="")try{var l=parseInt(s.attr("data-wbSaisieRicheImgRotate")||0)%2==1,c=s[0].style.transform.split("rad").map(function(n){return n.split("rotateZ(")[1]}).reduce(function(n){return n?-1*parseFloat(n):0}),e={w:s.width(),h:s.height()},r=new Image,f=$("<canvas>");f.attr({width:e.w,height:e.h});u=f[0].getContext("2d");r.setAttribute("crossOrigin","anonymous");r.onload=function(){var t=f[0].width/2,o=f[0].height/2,l=r.width,a=r.height;u.translate(t,o);u.rotate(-c);u.drawImage(r,-l/2,-a/2,l,a);u.rotate(c);u.translate(-t,-o);s[0].src=f[0].toDataURL();s[0].style.width=e.w+"px";s[0].style.height=e.h+"px";s[0].style.transform="";i();h=tt(s);n.NotifieApresModification()};r.src=s[0].src;return}catch(a){s[0].style.transform="";i()}o=$.extend({bgColor:"transparent",document:n.m_oDocument},getComputedStyle(s[0]));o.aspectRatio=undefined;s.Jcrop(o,function(){var i=this;i.setSelect([0,0,h.width,h.height]);$(n.m_oWindowPrincipale.document.body).on("mousedown.wb.saisieriche.crop",function(){t.trigger("trigger.wb.saisieriche.crop")});t.trigger("trigger.wb.saisieriche.deselectionneTout");t.on("keyup.wb.saisieriche.crop click.wb.saisieriche.crop trigger.wb.saisieriche.crop",function(r){function l(){i.destroy();s[0].style.display=o.display;setTimeout(function(){t.trigger("trigger.wb.saisieriche.selectionne",s)},100)}var f,a;if(r.type=="keyup"?r.which==13?f=!0:r.which==27&&(f=!1):r.type=="click"?clWDUtil.bEstFils(r.target,t.find(".jcrop-holder").get(0))||(f=!0):r.type==="trigger"&&(f=!0),f!==undefined){if(t.off("keyup.wb.saisieriche.crop click.wb.saisieriche.crop"),$(n.m_oWindowPrincipale.document.body).off("mousedown.wb.saisieriche.crop"),!f){i.destroy();return}try{var u=i.tellSelect(),e=new Image,c=$("<canvas>");c.attr({width:u.w,height:u.h});a=c[0].getContext("2d");e.setAttribute("crossOrigin","anonymous");e.onload=function(){a.drawImage(e,this.width*u.x/h.width,this.height*u.y/h.height,this.width*u.w/h.width,this.height*u.h/h.height,0,0,u.w,u.h);s[0].src=c[0].toDataURL();s[0].style.width=u.w+"px";s[0].style.height=u.h+"px";n.NotifieApresModification()};e.onerror=function(n){return d(n,s)};e.src=s[0].src;l()}catch(v){d(v,s);l()}}})});t.trigger("trigger.wb.saisieriche.deselectionneTout")});return}u.style&&(v=$.extend({},u.style),c={marginLeft:s[0].style.marginLeft,marginTop:s[0].style.marginTop,marginRight:s[0].style.marginRight,marginBottom:s[0].style.marginBottom},c.marginLeft=="auto"&&(c.marginLeft=0),c.marginRight=="auto"&&(c.marginRight=0),v.width?v.height="auto":(v.width=s[0].style.width=="100%"?h.width/2:h.width,v.height=s[0].style.width=="100%"?"auto":h.height),s.css(v),s[0].style.marginTop=c.marginTop,s[0].style.marginBottom=c.marginBottom,s[0].style.width=="100%"||s[0].style.margin.indexOf("auto")>-1||(s[0].style.marginLeft=c.marginLeft,s[0].style.marginRight=c.marginRight),n.NotifieApresModification())}}t.trigger("trigger.wb.saisieriche.selectionne",s)}}.bind(this);$(this).on("click.wb.saisieriche.barreimg",i)});ft(h,c,s);n.m_oElementCourant={};n.m_oElementCourant[n.sGetWLEXEC("JSEXEC_ELEMENTCOURANT_READIMG")]=function(){return ot(s)};n.m_oElementCourant[n.sGetWLEXEC("JSEXEC_ELEMENTCOURANT_WRITEIMG")]=function(t){try{var i=typeof t=="object"?t:JSON.parse(t)}catch(r){return!1}return n.EmpileUndoRedo(s,function(){return ot(s,i)}.bind(this))}}}function ui(n,t){var u,i,r,f;if(n.dataTransfer){for(u=0;n.dataTransfer.files&&u<n.dataTransfer.files.length;++u)t(n.dataTransfer.files[u],n.dataTransfer.files.length);return}for(n.clipboardData==!1&&typeof t=="function"&&t(undefined),i=n.clipboardData.items,i==undefined&&typeof t=="function"&&t(undefined),r=0;r<i.length;r++)i[r].type.indexOf("image")!=-1&&(f=i[r].getAsFile(),typeof t=="function"&&t(f,i.length))}var f,et,ot,st,r,rt,g,ut,nt,w,a,ct,b,v,lt,s,h,y,at,k;if(this.m_oOptions&&(this.m_oOptions.bGestionImages||this.m_oOptions.bGestionTables||this.m_oOptions.bGestionLiens)){this.m_oDocumentElement.setAttribute("class",(this.m_oDocumentElement.getAttribute("class")||"")+" wbSaisieRicheIframeHtml");f=this.m_oBody.getAttribute("class")||"";f&&(f+=" ");f+="wbSaisieRicheIframeBody";this.m_oOptions.bGestionImages&&(f+=" wbSaisieRicheIframeBodyGestionImage");this.m_oOptions.bGestionTables&&(f+=" wbSaisieRicheIframeBodyGestionTable");this.m_oOptions.bGestionLiens&&(f+=" wbSaisieRicheIframeBodyGestionLien");this.m_oBody.setAttribute("class",f);this.m_oOptions.bGestionImages&&this.__AjouteJCrop();var p=this.m_oDocument,e=this.m_oWindowPrincipale,t=$(p.body),n=this,bt=!1,i=$(),kt=$('<div contenteditable="false" id="wbSaisieRicheTrackerCoinNW"  class="wbSaisieRicheTrackerCoin" unselectable="true"><\/div>');i=i.add(kt);et=$('<div contenteditable="false" id="wbSaisieRicheTrackerCoinSW"  class="wbSaisieRicheTrackerCoin" unselectable="true"><\/div>');i=i.add(et);ot=$('<div contenteditable="false" id="wbSaisieRicheTrackerCoinNE"  class="wbSaisieRicheTrackerCoin" unselectable="true"><\/div>');i=i.add(ot);st=$('<div contenteditable="false" id="wbSaisieRicheTrackerCoinSE"  class="wbSaisieRicheTrackerCoin" unselectable="true"><\/div>');i=i.add(st);var u=$('<div contenteditable="false" id="wbSaisieRicheWrapperSelection" class="wbSaisieRicheWrapperSelection" unselectable="true"><\/div>'),ht={wbSaisieRicheTrackerCoinNW:[0,0,-1,-1],wbSaisieRicheTrackerCoinNE:[1,0,1,-1],wbSaisieRicheTrackerCoinSE:[1,1,1,1],wbSaisieRicheTrackerCoinSW:[0,1,-1,1]},dt={wbSaisieRicheTrackerCoinNW:[-1,1],wbSaisieRicheTrackerCoinNE:[1,1],wbSaisieRicheTrackerCoinSE:[1,-1],wbSaisieRicheTrackerCoinSW:[-1,-1]};i.each(function(){ht[this.id].elem=$(this)});r=$('<div contenteditable="false" id="wbSaisieRicheTrackerMargeWrap" class="wbSaisieRicheTrackerMargeWrap" unselectable="true"><\/div>');rt=$('<div contenteditable="false" title="'+n.sGetTraduction("HTML_TOOLBAR.DLG.DBL")+'" id="wbSaisieRicheTrackerMargeT"  class="wbSaisieRicheTrackerMarge" unselectable="true"><\/div>');r.append(rt);g=$('<div contenteditable="false" title="'+n.sGetTraduction("HTML_TOOLBAR.DLG.DBL")+'" id="wbSaisieRicheTrackerMargeR"  class="wbSaisieRicheTrackerMarge" unselectable="true"><\/div>');r.append(g);ut=$('<div contenteditable="false" title="'+n.sGetTraduction("HTML_TOOLBAR.DLG.DBL")+'" id="wbSaisieRicheTrackerMargeB"  class="wbSaisieRicheTrackerMarge" unselectable="true"><\/div>');r.append(ut);nt=$('<div contenteditable="false" title="'+n.sGetTraduction("HTML_TOOLBAR.DLG.DBL")+'" id="wbSaisieRicheTrackerMargeL"  class="wbSaisieRicheTrackerMarge" unselectable="true"><\/div>');r.append(nt);i=i.add(r);var c=$('<ul id="wbSaisieRicheBarreImg" class="wbSaisieRicheBarreImg wbBarreOutilsMiniBarreUl wbSaisieRicheBarre" unselectable="true" contenteditable="false"><\/ul>'),l=$('<ul id="wbSaisieRicheBarreLien" class="wbSaisieRicheBarreLien wbBarreOutilsMiniBarreUl wbSaisieRicheBarre" unselectable="true" contenteditable="false"><\/ul>'),o=[{sLibelle:n.sGetTraduction("HTML_TOOLBAR.HAB",0),nIndiceYDansPlanche:28,style:{maxWidth:"100%",width:"",float:"none",display:"inline",margin:"0"}},{sLibelle:n.sGetTraduction("HTML_TOOLBAR.HAB",1),nIndiceYDansPlanche:30,style:{maxWidth:"100%",width:"",float:"left",display:"inline",margin:"0"}},{sLibelle:n.sGetTraduction("HTML_TOOLBAR.HAB",2),nIndiceYDansPlanche:29,style:{maxWidth:"100%",width:"",float:"right",display:"inline",margin:"0"}},{sLibelle:n.sGetTraduction("HTML_TOOLBAR.HAB",3),nIndiceYDansPlanche:31,style:{maxWidth:"100%",width:"",float:"none",display:"block",margin:"0 auto"}},{sLibelle:n.sGetTraduction("HTML_TOOLBAR.HAB",4),nIndiceYDansPlanche:32,style:{maxWidth:"100%",width:"100%",float:"none",display:"block",margin:"0"}}];for($.Jcrop&&o.push({sLibelle:n.sGetTraduction("HTML_TOOLBAR.HAB",6),nIndiceYDansPlanche:40,action:"CROP_SRC"}),o.push({sLibelle:n.sGetTraduction("HTML_TOOLBAR.HAB",7),nIndiceYDansPlanche:41,action:"ROTATE_CLOCKWISE_COPY"}),o.push({sLibelle:n.sGetTraduction("HTML_TOOLBAR.HAB",8),nIndiceYDansPlanche:35,action:"MODIFIER_ALT"}),this.m_bModeWeb&&o.push({sLibelle:n.sGetTraduction("HTML_TOOLBAR.HAB",5),nIndiceYDansPlanche:25,action:"MODIFIER_SRC"}),w="wbBarreOutilsImgPlanche"+(bIEAvec11||bEdge?"":" wbBarreOutilsImgPlancheSVG"),this.m_bModeWeb||(w="wbBarreOutilsImgPlanche wbBarreOutilsImgPlancheSVGWDL"),a=0;a<o.length;++a)ct=$('<li class="wbSaisieRicheBarreImgLi wbBarreOutilsMiniBarreLi" id="wbSaisieRicheBarreImgLi'+a+'"><i class="wbBarreOutilsImgPlancheWrap"><i title="'+o[a].sLibelle+'" style="cursor:pointer;transform:translateY(calc(-100% * '+o[a].nIndiceYDansPlanche+" / "+WDSaisieAPI.PLANCHE_NB_IMAGES+'));" class="'+w+' wbplanche wbPlanche5Etat1Anim"><\/i><\/li>'),c.append(ct);for(b=[{sLibelle:n.sGetTraduction("HTML_TOOLBAR.LNK",0),nIndiceYDansPlanche:37,fAction:function(n){e.open(n.attr("href"),"_blank")}},{sLibelle:n.sGetTraduction("HTML_TOOLBAR.LNK",1),nIndiceYDansPlanche:24,fAction:function(t){var r=t.attr("href").endsWith(t.text()),i=prompt(n.sGetTraduction("HTML_TOOLBAR.DLG.LNK")||"URL ?",t.attr("href"));if(i)return r&&t.text(i),t.attr("href",i),n.NotifieApresModification(),!0}},{sLibelle:n.sGetTraduction("HTML_TOOLBAR.LNK",2),nIndiceYDansPlanche:38,fAction:function(t){return t.replaceWith("<span>"+t.html()+"<\/span>"),!1}},],v=0;v<b.length;++v)lt=$('<li class="wbSaisieRicheBarreLienLi wbBarreOutilsMiniBarreLi" id="wbSaisieRicheBarreLienLi'+v+'"><i class="wbBarreOutilsImgPlancheWrap"><i title="'+b[v].sLibelle+'" style="cursor:pointer;transform:translateY(calc(-100% * '+b[v].nIndiceYDansPlanche+" / "+WDSaisieAPI.PLANCHE_NB_IMAGES+'));" class="'+w+' wbplanche wbPlanche5Etat1Anim"><\/i><\/li>'),l.append(lt);for(s=$('<ul id="wbSaisieRicheBarreTable" class="wbSaisieRicheBarreTable wbBarreOutilsMiniBarreUl wbSaisieRicheBarre" unselectable="true" contenteditable="false"><\/ul>'),h=[{sLibelle:n.sGetTraduction("HTML_TOOLBAR.TABLE.ROW.BEFORE"),nIndiceYDansPlanche:42,action:"ROW.BEFORE"},{sLibelle:n.sGetTraduction("HTML_TOOLBAR.TABLE.ROW.AFTER"),nIndiceYDansPlanche:43,action:"ROW.AFTER"},{sLibelle:n.sGetTraduction("HTML_TOOLBAR.TABLE.ROW.DELETE"),nIndiceYDansPlanche:44,action:"ROW.DELETE"},{sLibelle:n.sGetTraduction("HTML_TOOLBAR.TABLE.COLUMN.BEFORE"),nIndiceYDansPlanche:45,action:"COLUMN.BEFORE"},{sLibelle:n.sGetTraduction("HTML_TOOLBAR.TABLE.COLUMN.AFTER"),nIndiceYDansPlanche:46,action:"COLUMN.AFTER"},{sLibelle:n.sGetTraduction("HTML_TOOLBAR.TABLE.COLUMN.DELETE"),nIndiceYDansPlanche:47,action:"COLUMN.DELETE"},{sLibelle:n.sGetTraduction("HTML_TOOLBAR.TABLE.CELL.PROP"),nIndiceYDansPlanche:51,action:"WLEXEC",param:n.sGetWLEXEC("WLEXEC_EDITTABLECEL")},{sLibelle:n.sGetTraduction("HTML_TOOLBAR.TABLE.ROW.PROP"),nIndiceYDansPlanche:49,action:"WLEXEC",param:n.sGetWLEXEC("WLEXEC_EDITTABLEROW")},{sLibelle:n.sGetTraduction("HTML_TOOLBAR.TABLE.COLUMN.PROP"),nIndiceYDansPlanche:50,action:"WLEXEC",param:n.sGetWLEXEC("WLEXEC_EDITTABLECOL")},{sLibelle:n.sGetTraduction("HTML_TOOLBAR.TABLE.PROP"),nIndiceYDansPlanche:48,action:"WLEXEC",param:n.sGetWLEXEC("WLEXEC_EDITTABLE")}],n.m_bModeWeb&&(h=h.concat([{sLibelle:n.sGetTraduction("HTML_TOOLBAR.TABLE.STYLE"),nIndiceYDansPlanche:54,action:"WLEXEC",param:n.sGetWLEXEC("WLEXEC_EDITTABLESTYLE"),bForceModeWeb:!0}])),y=0;y<h.length;++y)at=$('<li class="wbSaisieRicheBarreTableLi wbBarreOutilsMiniBarreLi" id="wbSaisieRicheBarreTableLi'+y+'"><i class="wbBarreOutilsImgPlancheWrap"><i title="'+h[y].sLibelle+'" style="cursor:pointer;transform:translateY(calc(-100% * '+h[y].nIndiceYDansPlanche+" / "+WDSaisieAPI.PLANCHE_NB_IMAGES+'));" class="'+w+' wbplanche wbPlanche5Etat1Anim"><\/i><\/li>'),s.append(at);k=["width","height","align","bgcolor","border","colspan","rowspan","valign","cellpadding","cellspacing","alt","hspace","vspace","crossorigin","decoding","ismap","loading","sizes","src","srcset","usemap"];$(window).on("resize.wb.saisieriche",function(){t.trigger("trigger.wb.saisieriche.deselectionneTout")});$(n.m_oWindowPrincipale.document).on("mousedown.wb.saisieriche.deselectionneTout",function(){t.trigger("trigger.wb.saisieriche.deselectionneTout")});t.on("trigger.wb.saisieriche.deselectionneTout",function(){n._DesactiveEcoute_SelectionChanged();t.find(".wbSaisieRicheImgSelectionne").each(function(){return $(this).removeClass("wbSaisieRicheImgSelectionne"),i.removeClass("wbSaisieRicheTrackerCoinShift"),r.children().off(),i=i.off().detach(),c.children().off(),c=c.detach(),!1});t.find(".wbSaisieRicheLienSelectionne").each(function(){return $(this).removeClass("wbSaisieRicheLienSelectionne"),l.children().off(),l=l.detach(),!1});t.find(".wbSaisieRicheTableSelectionne").each(function(){return $(this).removeClass("wbSaisieRicheTableSelectionne").find("td").removeClass("wbSaisieRicheTdSelectionne"),s.children().off(),s=s.detach(),t.off("keydown.wb.saisieriche.barretable"),!1});t.find(".wbSaisieRicheWrapperSelection").each(function(){return u=u.off().detach(),!1});n._ActiveEcoute_SelectionChanged()}).on("blur.wb.saisieriche.quitte",function(){t.trigger("trigger.wb.saisieriche.deselectionneTout")}).on("keydown.wb.saisieriche.selectionne",function(n){if(t.find(".wbSaisieRicheImgSelectionne").length&&!t.find(".wbSaisieRicheImgGhost").length){var u=n&&(n.shiftKey||n.which==16),f=n&&(n.ctrlKey||n.which==17),r=!1;u&&(r=!0,bt&&i.addClass("wbSaisieRicheTrackerCoinShift"));f&&(r=!0);r||(i.removeClass("wbSaisieRicheTrackerCoinShift"),t.trigger("trigger.wb.saisieriche.deselectionneTout"))}}).on("click.wb.saisieriche.selectionne keyup.wb.saisieriche.selectionne trigger.wb.saisieriche.selectionne input.wb.saisieriche.selectionne DOMCharacterDataModified.wb.saisieriche.selectionne",function(i,r){if(!i||i.type!=="input"||!n.m_bUndoRedoEnCours){var u=$(r||i.target),o=u,e=n.__oGetSelection();if(e&&e.focusNode)if(e.rangeCount===0)o=e.focusNode.nodeType===Node.ELEMENT_NODE?$(e.focusNode):$(e.focusNode).parent();else{var f=e.getRangeAt(0),s=[],a=f.startContainer.nodeType===Node.ELEMENT_NODE?f.startContainer:f.startContainer.parentElement,v=f.endContainer.nodeType===Node.ELEMENT_NODE?f.endContainer:f.endContainer.parentElement,h=$(a).add(v);$(f.commonAncestorContainer).find("td").add(f.commonAncestorContainer).filter("td").each(function(){if(this===h[0])s.push(this);else{if(this===h[1])return s.push(this),!1;s.length&&s.push(this)}});o=h.add($(s))}var c=o.parents().add(o).add(u).closest("td,th"),y=i&&(i.shiftKey||i.which==16),p=i&&(i.ctrlKey||i.which==17),l=!1;if((i.type!="DOMCharacterDataModified"&&i.type!="input"&&(i.type=="keyup"&&(y||p)||(l=!0,t.trigger("trigger.wb.saisieriche.deselectionneTout"))),u&&u.length)&&u[0].parentElement)if(u.is("img"))ri(u,i);else if(u.is("a[href]"))ii(u,i);else if(o.length===1&&c.length)l||t.trigger("trigger.wb.saisieriche.deselectionneTout"),vt(c.last(),i);else return}}).on("dragstart.wb.saisieriche.image",function(n){n.originalEvent.dataTransfer.setData("wbSaisieRicheDragStart",!0)}).on("dragover.wb.saisieriche.image",function(n){var i=n.originalEvent?n.originalEvent:n,r=i.dataTransfer&&i.dataTransfer.items?i.dataTransfer.items[0]:undefined;r&&r.type&&r.type.match("image.*")&&(t.addClass("wbSaisieRicheIframeBodyDragImg"),n.stopPropagation(),n.preventDefault())}).on("dragend.wb.saisieriche.image mouseup.wb.saisieriche.image mouseleave.wb.saisieriche.image",function(n){t.removeClass("wbSaisieRicheIframeBodyDragImg");n.originalEvent&&n.originalEvent.dataTransfer&&n.originalEvent.dataTransfer.setData("wbSaisieRicheDragStart",undefined)}).on("drop.wb.saisieriche.image paste.wb.saisieriche.image",function(i){var r,u,f,e;(t.removeClass("wbSaisieRicheIframeBodyDragImg"),r=i.originalEvent?i.originalEvent:i,u=!1,i.originalEvent.dataTransfer&&(u=i.originalEvent.dataTransfer.getData("wbSaisieRicheDragStart"),bFF||i.originalEvent.dataTransfer.setData("wbSaisieRicheDragStart",undefined)),f=r.clientX,e=r.clientY,!u||i.ctrlKey)&&ui(r,function(i,u){if(i&&i.type&&i.type.match("image.*")){r.stopPropagation();r.preventDefault();var f=new FileReader,e;f.onload=function(i){var o=i.target.result,r=p.createElement("img"),f;r.setAttribute("crossOrigin","anonymous");r.src=o;r.style.width=Math.min(t.width()*.8/u,200)+"px";r.style.margin="24px";f=n.__oGetSelection();e=f.getRangeAt(0);try{e.insertNode(r)}catch(s){t.get(0).appendChild(r)}n.NotifieApresModification();setTimeout(function(){t.trigger("trigger.wb.saisieriche.selectionne",$(r))},100)};f.readAsDataURL(i)}})})}};WDSaisieAPI.prototype.__AjouteJCrop=function(){(function(n){var t=window.document;n.Jcrop=function(i,r){function c(n){return Math.round(n)+"px"}function et(n){return u.baseClass+"-"+n}function ki(){return n.fx.step.hasOwnProperty("backgroundColor")}function ot(t){var i=n(t).offset();return[i.left,i.top]}function tt(n){return[n.pageX-k[0],n.pageY-k[1]]}function ui(t){typeof t!="object"&&(t={});u=n.extend(u,t);n.each(["onChange","onSelect","onRelease","onDblClick"],function(n,t){typeof u[t]!="function"&&(u[t]=function(){})})}function fi(n,t,i){if(k=ot(o),w.setCursor(n==="move"?n:n+"-resize"),n==="move")return w.activateHandlers(gi(t),wt,i);var u=h.getFixed(),r=ei(n),f=h.getCorner(ei(r));h.setPressed(h.getCorner(r));h.setCurrent(f);w.activateHandlers(di(n,u),wt,i)}function di(n,t){return function(i){if(u.aspectRatio)switch(n){case"e":i[1]=t.y+1;break;case"w":i[1]=t.y+1;break;case"n":i[0]=t.x+1;break;case"s":i[0]=t.x+1}else switch(n){case"e":i[1]=t.y2;break;case"w":i[1]=t.y2;break;case"n":i[0]=t.x2;break;case"s":i[0]=t.x2}h.setCurrent(i);f.update()}}function gi(n){var t=n;return dt.watchKeys(),function(n){h.moveOffset([n[0]-t[0],n[1]-t[1]]);t=n;f.update()}}function ei(n){switch(n){case"n":return"sw";case"s":return"nw";case"e":return"nw";case"w":return"ne";case"ne":return"sw";case"nw":return"se";case"se":return"nw";case"sw":return"ne"}}function oi(n){return function(t){return u.disabled?!1:n==="move"&&!u.allowMove?!1:(k=ot(o),ft=!0,fi(n,tt(t)),t.stopPropagation(),t.preventDefault(),!1)}}function si(n,t,i){var r=n.width(),u=n.height();r>t&&t>0&&(r=t,u=t/n.width()*n.height());u>i&&i>0&&(u=i,r=i/n.height()*n.width());a=n.width()/r;v=n.height()/u;n.width(r).height(u)}function st(n){return{x:n.x*a,y:n.y*v,x2:n.x2*a,y2:n.y2*v,w:n.w*a,h:n.h*v}}function wt(){var n=h.getFixed();n.w>u.minSelect[0]&&n.h>u.minSelect[1]?(f.enableHandles(),f.done()):f.release();w.setCursor(u.allowSelect?"crosshair":"default")}function hi(n){if(u.disabled||!u.allowSelect)return!1;ft=!0;k=ot(o);f.disableHandles();w.setCursor("crosshair");var t=tt(n);return h.setPressed(t),f.update(),w.activateHandlers(nr,wt,n.type.substring(0,5)==="touch"),dt.watchKeys(),n.stopPropagation(),n.preventDefault(),!1}function nr(n){h.setCurrent(n);f.update()}function ci(){var t=n("<div><\/div>").addClass(et("tracker"));return ii&&t.css({opacity:0,backgroundColor:"white"}),t}function tr(n){b.removeClass().addClass(et("holder")).addClass(n)}function ir(n,t){function b(){window.setTimeout(k,d)}var c=n[0]/a,l=n[1]/v,p=n[2]/a,w=n[3]/v,k;if(!kt){var o=h.flipCoords(c,l,p,w),s=h.getFixed(),e=[s.x,s.y,s.x2,s.y2],i=e,d=u.animationDelay,g=o[0]-e[0],nt=o[1]-e[1],tt=o[2]-e[2],it=o[3]-e[3],r=0,rt=u.swingSpeed;c=i[0];l=i[1];p=i[2];w=i[3];f.animMode(!0);k=function(){return function(){r+=(100-r)/rt;i[0]=Math.round(c+r/100*g);i[1]=Math.round(l+r/100*nt);i[2]=Math.round(p+r/100*tt);i[3]=Math.round(w+r/100*it);r>=99.8&&(r=100);r<100?(pi(i),b()):(f.done(),f.animMode(!1),typeof t=="function"&&t.call(y))}}();b()}}function yi(n){pi([n[0]/a,n[1]/v,n[2]/a,n[3]/v]);u.onSelect.call(y,st(h.getFixed()));f.enableHandles()}function pi(n){h.setPressed([n[0],n[1]]);h.setCurrent([n[2],n[3]]);f.update()}function rr(){return st(h.getFixed())}function ur(){return h.getFixed()}function fr(n){ui(n);ni()}function wi(){u.disabled=!0;f.disableHandles();f.setCursor("default");w.setCursor("default")}function bi(){u.disabled=!1;ni()}function er(){f.done();w.activateHandlers(null,null)}function or(){b.remove();l.show();l.css("visibility","visible");n(i).removeData("Jcrop")}function sr(n,t){f.release();wi();var i=new Image;i.onload=function(){var r=i.width,f=i.height,h=u.boxWidth,c=u.boxHeight;o.width(r).height(f);o.attr("src",n);d.attr("src",n);si(o,h,c);s=o.width();e=o.height();d.width(s).height(e);g.width(s+ut*2).height(e+ut*2);b.width(s).height(e);nt.resize(s,e);bi();typeof t=="function"&&t.call(y)};i.src=n}function gt(n,t,i){var r=t||u.bgColor;u.bgFade&&ki()&&u.fadeTime&&!i?n.animate({backgroundColor:r},{queue:!1,duration:u.fadeTime}):n.css("backgroundColor",r)}function ni(n){u.allowResize?n?f.enableOnly():f.enableHandles():f.disableHandles();w.setCursor(u.allowSelect?"crosshair":"default");f.setCursor(u.allowMove?"move":"default");u.hasOwnProperty("trueSize")&&(a=u.trueSize[0]/s,v=u.trueSize[1]/e);u.hasOwnProperty("setSelect")&&(yi(u.setSelect),f.done(),delete u.setSelect);nt.refresh();u.bgColor!=ai&&(gt(u.shade?nt.getShades():b,u.shade?u.shadeColor||u.bgColor:u.bgColor),ai=u.bgColor);ht!=u.bgOpacity&&(ht=u.bgOpacity,u.shade?nt.refresh():f.setBgOpacity(ht));ct=u.maxSize[0]||0;lt=u.maxSize[1]||0;at=u.minSize[0]||0;vt=u.minSize[1]||0;u.hasOwnProperty("outerImage")&&(o.attr("src",u.outerImage),delete u.outerImage);f.refresh()}var u=n.extend({},n.Jcrop.defaults),k,ti=navigator.userAgent.toLowerCase(),ii=/msie/.test(ti),ri=/msie [1-6]\./.test(ti),yt,o,y;u.document&&(t=u.document);typeof i!="object"&&(i=n(i)[0]);typeof r!="object"&&(r={});ui(r);var bt={border:"none",visibility:"visible",margin:0,padding:0,position:"absolute",top:0,left:0},l=n(i),li=!0;i.tagName=="IMG"?(l[0].width!=0&&l[0].height!=0?(l.width(l[0].width),l.height(l[0].height)):(yt=new Image,yt.src=l[0].src,l.width(yt.width),l.height(yt.height)),o=l.clone().removeAttr("id").css(bt).show(),o.width(l.width()),o.height(l.height()),l.after(o).hide()):(o=l.css(bt).show(),li=!1,u.shade===null&&(u.shade=!0));si(o,u.boxWidth,u.boxHeight);var s=o.width(),e=o.height(),b=n("<div />").width(s).height(e).addClass(et("holder")).css({position:"relative",backgroundColor:u.backgroundColor||u.bgColor,verticalAlign:u.verticalAlign,float:u.float,margin:u.margin,display:u.display&&u.display=="inline"?"inline-block":u.display}).insertAfter(l).append(o);u.addClass&&b.addClass(u.addClass);var d=n("<div />"),pt=n("<div />").width("100%").height("100%").css({zIndex:310,position:"absolute",overflow:"hidden"}),it=n("<div />").width("100%").height("100%").css("zIndex",320),rt=n("<div />").css({position:"absolute",zIndex:600}).dblclick(function(){var n=h.getFixed();u.onDblClick.call(y,n)}).insertBefore(o).append(pt,it);li&&(d=n("<img />").attr("src",o.attr("src")).css(bt).width(s).height(e),pt.append(d));ri&&rt.css({overflowY:"hidden"});var ut=u.boundary,g=ci().width(s+ut*2).height(e+ut*2).css({position:"absolute",top:c(-ut),left:c(-ut),zIndex:290}).mousedown(hi),ai=u.bgColor,ht=u.bgOpacity,ct,lt,at,vt,a,v,ft,kt,vi;k=ot(o);var p=function(){function n(){var r={},f=["touchstart","touchmove","touchend"],e=t.createElement("div"),i,n,u;try{for(i=0;i<f.length;i++)n=f[i],n="on"+n,u=n in e,u||(e.setAttribute(n,"return;"),u=typeof e[n]=="function"),r[f[i]]=u;return r.touchstart&&r.touchend&&r.touchmove}catch(o){return!1}}function i(){return u.touchSupport===!0||u.touchSupport===!1?u.touchSupport:n()}return{createDragger:function(n){return function(t){return u.disabled?!1:n==="move"&&!u.allowMove?!1:(k=ot(o),ft=!0,fi(n,tt(p.cfilter(t)),!0),t.stopPropagation(),t.preventDefault(),!1)}},newSelection:function(n){return hi(p.cfilter(n))},cfilter:function(n){return n.pageX=n.originalEvent.changedTouches[0].pageX,n.pageY=n.originalEvent.changedTouches[0].pageY,n},isSupported:n,support:i()}}(),h=function(){function p(u){u=l(u);r=n=u[0];i=t=u[1]}function w(n){n=l(n);o=n[0]-r;h=n[1]-i;r=n[0];i=n[1]}function b(){return[o,h]}function k(u){var f=u[0],o=u[1];0>n+f&&(f-=f+n);0>t+o&&(o-=o+t);e<i+o&&(o+=e-(i+o));s<r+f&&(f+=s-(r+f));n+=f;r+=f;t+=o;i+=o}function d(n){var t=c();switch(n){case"ne":return[t.x2,t.y];case"nw":return[t.x,t.y];case"se":return[t.x2,t.y2];case"sw":return[t.x,t.y2]}}function c(){if(!u.aspectRatio)return g();var c=u.aspectRatio,b=u.minSize[0]/a,w=u.maxSize[0]/a,nt=u.maxSize[1]/v,k=r-n,d=i-t,tt=Math.abs(k),it=Math.abs(d),rt=tt/it,o,h,l,p;return w===0&&(w=s*10),nt===0&&(nt=e*10),rt<c?(h=i,l=it*c,o=k<0?n-l:l+n,o<0?(o=0,p=Math.abs((o-n)/c),h=d<0?t-p:p+t):o>s&&(o=s,p=Math.abs((o-n)/c),h=d<0?t-p:p+t)):(o=r,p=tt/c,h=d<0?t-p:t+p,h<0?(h=0,l=Math.abs((h-t)*c),o=k<0?n-l:l+n):h>e&&(h=e,l=Math.abs(h-t)*c,o=k<0?n-l:l+n)),o>n?(o-n<b?o=n+b:o-n>w&&(o=n+w),h=h>t?t+(o-n)/c:t-(o-n)/c):o<n&&(n-o<b?o=n-b:n-o>w&&(o=n-w),h=h>t?t+(n-o)/c:t-(n-o)/c),o<0?(n-=o,o=0):o>s&&(n-=o-s,o=s),h<0?(t-=h,h=0):h>e&&(t-=h-e,h=e),y(f(n,t,o,h))}function l(n){return n[0]<0&&(n[0]=0),n[1]<0&&(n[1]=0),n[0]>s&&(n[0]=s),n[1]>e&&(n[1]=e),[Math.round(n[0]),Math.round(n[1])]}function f(n,t,i,r){var u=n,f=i,e=t,o=r;return i<n&&(u=i,f=n),r<t&&(e=r,o=t),[u,e,f,o]}function g(){var o=r-n,h=i-t,u;return ct&&Math.abs(o)>ct&&(r=o>0?n+ct:n-ct),lt&&Math.abs(h)>lt&&(i=h>0?t+lt:t-lt),vt/v&&Math.abs(h)<vt/v&&(i=h>0?t+vt/v:t-vt/v),at/a&&Math.abs(o)<at/a&&(r=o>0?n+at/a:n-at/a),n<0&&(r-=n,n-=n),t<0&&(i-=t,t-=t),r<0&&(n-=r,r-=r),i<0&&(t-=i,i-=i),r>s&&(u=r-s,n-=u,r-=u),i>e&&(u=i-e,t-=u,i-=u),n>s&&(u=n-e,i-=u,t-=u),t>e&&(u=t-e,i-=u,t-=u),y(f(n,t,r,i))}function y(n){return{x:n[0],y:n[1],x2:n[2],y2:n[3],w:n[2]-n[0],h:n[3]-n[1]}}var n=0,t=0,r=0,i=0,o,h;return{flipCoords:f,setPressed:p,setCurrent:w,getOffset:b,moveOffset:k,getCorner:d,getFixed:c}}(),nt=function(){function nt(n,t){i.left.css({height:c(t)});i.right.css({height:c(t)})}function v(){return y(h.getFixed())}function y(n){i.top.css({left:c(n.x),width:c(n.w),height:c(n.y)});i.bottom.css({top:c(n.y2),left:c(n.x),width:c(n.w),height:c(e-n.y2)});i.right.css({left:c(n.x2),width:c(s-n.x2)});i.left.css({width:c(n.x)})}function l(){return n("<div />").css({position:"absolute",backgroundColor:u.shadeColor||u.bgColor}).appendTo(t)}function p(){r||(r=!0,t.insertBefore(o),v(),f.setBgOpacity(1,0,1),d.hide(),w(u.shadeColor||u.bgColor,1),f.isAwake()?a(u.bgOpacity,1):a(1,1))}function w(n,t){gt(g(),n,t)}function k(){r&&(t.remove(),d.show(),r=!1,f.isAwake()?f.setBgOpacity(u.bgOpacity,1,1):(f.setBgOpacity(1,1,1),f.disableHandles()),gt(b,0,1))}function a(n,i){r&&(u.bgFade&&!i?t.animate({opacity:1-n},{queue:!1,duration:u.fadeTime}):t.css({opacity:1-n}))}function tt(){u.shade?p():k();f.isAwake()&&a(u.bgOpacity)}function g(){return t.children()}var r=!1,t=n("<div />").css({position:"absolute",zIndex:240,opacity:0}),i={top:l(),left:l().height(e),right:l().height(e),bottom:l()};return{update:v,updateRaw:y,getShades:g,setBgColor:w,enable:p,disable:k,resize:nt,refresh:tt,opacity:a}}(),f=function(){function ot(t){var i=n("<div />").css({position:"absolute",opacity:u.borderOpacity}).addClass(et(t));return pt.append(i),i}function a(t,i){var r=n("<div />").mousedown(oi(t)).css({cursor:t+"-resize",position:"absolute",zIndex:i}).addClass("ord-"+t);return p.support&&r.bind("touchstart.jcrop",p.createDragger(t)),it.append(r),r}function ct(n){var t=u.handleSize,i=a(n,l++).css({opacity:u.handleOpacity}).addClass(et("handle"));return t&&i.width(t).height(t),i}function lt(n){return a(n,l++).addClass("jcrop-dragbar")}function at(n){for(var t=0;t<n.length;t++)ft[n[t]]=lt(n[t])}function vt(n){for(var t,i=0;i<n.length;i++){switch(n[i]){case"n":t="hline";break;case"s":t="hline bottom";break;case"e":t="vline right";break;case"w":t="vline"}tt[n[i]]=ot(t)}}function yt(n){for(var t=0;t<n.length;t++)ut[n[t]]=ct(n[t])}function wt(n,t){u.shade||d.css({top:c(-t),left:c(-n)});rt.css({top:c(t),left:c(n)})}function bt(n,t){rt.width(Math.round(n)).height(Math.round(t))}function v(){var n=h.getFixed();h.setPressed([n.x,n.y]);h.setCurrent([n.x2,n.y2]);w()}function w(n){if(i)return b(n)}function b(n){var t=h.getFixed();bt(t.w,t.h);wt(t.x,t.y);u.shade&&nt.updateRaw(t);i||dt();n?u.onSelect.call(y,st(t)):u.onChange.call(y,st(t))}function s(n,t,r){(i||t)&&(u.bgFade&&!r?o.animate({opacity:n},{queue:!1,duration:u.fadeTime}):o.css("opacity",n))}function dt(){rt.show();u.shade?nt.opacity(ht):s(ht,!0);i=!0}function gt(){f();rt.hide();u.shade?nt.opacity(1):s(1);i=!1;u.onRelease.call(y)}function ni(){r&&it.show()}function k(){return r=!0,u.allowResize?(it.show(),!0):void 0}function f(){r=!1;it.hide()}function g(n){n?(kt=!0,f()):(kt=!1,k())}function ti(){g(!1);v()}var i,l=370,tt={},ut={},ft={},r=!1,e;return u.dragEdges&&n.isArray(u.createDragbars)&&at(u.createDragbars),n.isArray(u.createHandles)&&yt(u.createHandles),u.drawBorders&&n.isArray(u.createBorders)&&vt(u.createBorders),n(t).bind("touchstart.jcrop-ios",function(t){n(t.currentTarget).hasClass("jcrop-tracker")&&t.stopPropagation()}),e=ci().mousedown(oi("move")).css({cursor:"move",position:"absolute",zIndex:360}),p.support&&e.bind("touchstart.jcrop",p.createDragger("move")),pt.append(e),f(),{updateVisible:w,update:b,release:gt,refresh:v,isAwake:function(){return i},setCursor:function(n){e.css("cursor",n)},enableHandles:k,enableOnly:function(){r=!0},showHandles:ni,disableHandles:f,animMode:g,setBgOpacity:s,done:ti}}(),w=function(){function l(i){g.css({zIndex:450});i?n(t).bind("touchmove.jcrop",w).bind("touchend.jcrop",b):s&&n(t).bind("mousemove.jcrop",c).bind("mouseup.jcrop",r)}function a(){g.css({zIndex:290});n(t).unbind(".jcrop")}function c(n){return i(tt(n)),!1}function r(n){return n.preventDefault(),n.stopPropagation(),ft&&(ft=!1,e(tt(n)),f.isAwake()&&u.onSelect.call(y,st(h.getFixed())),a(),i=function(){},e=function(){}),!1}function v(n,t,r){return ft=!0,i=n,e=t,l(r),!1}function w(n){return i(tt(p.cfilter(n))),!1}function b(n){return r(p.cfilter(n))}function k(n){g.css("cursor",n)}var i=function(){},e=function(){},s=u.trackDocument;return s||g.mousemove(c).mouseup(r).mouseout(r),o.before(g),{activateHandlers:v,setCursor:k}}(),dt=function(){function e(){u.keySupport&&(t.show(),t.focus())}function s(){t.hide()}function i(n,t,i){u.allowMove&&(h.moveOffset([t,i]),f.updateVisible(!0));n.preventDefault();n.stopPropagation()}function c(n){if(n.ctrlKey||n.metaKey)return!0;vi=n.shiftKey?!0:!1;var t=vi?10:1;switch(n.keyCode){case 37:i(n,-t,0);break;case 39:i(n,t,0);break;case 38:i(n,0,-t);break;case 40:i(n,0,t);break;case 27:u.allowSelect&&f.release();break;case 9:return!0}return!1}var t=n('<input type="radio" />').css({position:"fixed",left:"-120px",width:"12px"}).addClass("jcrop-keymgr"),r=n("<div />").css({position:"absolute",overflow:"hidden"}).append(t);return u.keySupport&&(t.keydown(c).blur(s),ri||!u.fixedSupport?(t.css({position:"absolute",left:"-20px"}),r.append(t).insertBefore(o)):t.insertBefore(o)),{watchKeys:e}}();return p.support&&g.bind("touchstart.jcrop",p.newSelection),it.hide(),ni(!0),y={setImage:sr,animateTo:ir,setSelect:yi,setOptions:fr,tellSelect:rr,tellScaled:ur,setClass:tr,disable:wi,enable:bi,cancel:er,release:f.release,destroy:or,focus:dt.watchKeys,getBounds:function(){return[s*a,e*v]},getWidgetSize:function(){return[s,e]},getScaleFactor:function(){return[a,v]},getOptions:function(){return u},ui:{holder:b,selection:rt}},ii&&b.bind("selectstart",function(){return!1}),l.data("Jcrop",y),y};n.fn.Jcrop=function(i,r){var u;return i.document&&(t=i.document),this.each(function(){if(n(this).data("Jcrop")){if(i==="api")return n(this).data("Jcrop");n(this).data("Jcrop").setOptions(i)}else this.tagName=="IMG"?n.Jcrop.Loader(this,function(){n(this).css({display:"block",visibility:"hidden"});u=n.Jcrop(this,i);n.isFunction(r)&&r.call(u)}):(n(this).css({display:"block",visibility:"hidden"}),u=n.Jcrop(this,i),n.isFunction(r)&&r.call(u))}),this};n.Jcrop.Loader=function(t,i,r){function e(){f.complete?(u.unbind(".jcloader"),n.isFunction(i)&&i.call(f)):window.setTimeout(e,50)}var u=n(t),f=u[0];u.bind("load.jcloader",e).bind("error.jcloader",function(){u.unbind(".jcloader");n.isFunction(r)&&r.call(f)});f.complete&&n.isFunction(i)&&(u.unbind(".jcloader"),i.call(f))};n.Jcrop.defaults={allowSelect:!0,allowMove:!0,allowResize:!0,trackDocument:!0,baseClass:"jcrop",addClass:null,bgColor:"black",bgOpacity:.6,bgFade:!1,borderOpacity:.4,handleOpacity:.5,handleSize:null,aspectRatio:0,keySupport:!0,createHandles:["n","s","e","w","nw","ne","se","sw"],createDragbars:["n","s","e","w"],createBorders:["n","s","e","w"],drawBorders:!0,dragEdges:!0,fixedSupport:!0,touchSupport:null,shade:null,boxWidth:0,boxHeight:0,boundary:2,fadeTime:400,animationDelay:20,swingSpeed:3,minSelect:[0,0],maxSize:[0,0],minSize:[0,0],onChange:function(){},onSelect:function(){},onDblClick:function(){},onRelease:function(){}}})(jQuery)};WDSaisieAPI.prototype.GetListeFeuillesCSS=function(){var n=[],t=this.m_oDocument.head.querySelectorAll("style[data-windev]");return t.forEach(function(t){var i={origine:t.getAttribute("data-windev"),integre:!0};n.push(i)}),t=this.m_oDocument.head.querySelectorAll("link[href]"),t.forEach(function(t){var i={origine:t.getAttribute("href"),integre:!1};n.push(i)}),JSON.stringify(n)};WDSaisieAPI.prototype.SupprimeFeuillesCSS=function(n,t){var i={balise:t?"style":"link",attr:t?"data-windev":"href"},r=!1;if(this.m_oDocument.head.querySelectorAll(i.balise+"["+i.attr+"]").forEach(function(t){t.getAttribute(i.attr)===n&&(t.remove(),r=!0)}.bind(this)),!r){alert("CSS not found : \n<"+sSelector+">");return}this.m_sDerniereValeurHtmlAffectee=undefined};WDSaisieAPI.prototype.AjouteFeuillesCSS=function(n,t,i){var r;t?(r=this.m_oDocument.createElement("style"),r.setAttribute("data-windev",n),r.innerHTML="\n"+i+"\n"):(r=this.m_oDocument.createElement("link"),r.setAttribute("href",n),r.setAttribute("rel","stylesheet"));this.m_oDocument.head.append(r);this.m_sDerniereValeurHtmlAffectee=undefined};WDSaisieAPI.prototype.GetScrollPosX=function(){return Math.floor(this.m_oWindow.scrollX)};WDSaisieAPI.prototype.GetScrollPosY=function(){return Math.floor(this.m_oWindow.scrollY)};WDSaisieAPI.prototype.SetScrollPosX=function(n){this.m_oWindow.scroll(n,this.m_oWindow.scrollY)};WDSaisieAPI.prototype.SetScrollPosY=function(n){this.m_oWindow.scroll(this.m_oWindow.scrollY,n)};WDSaisieAPI.prototype.GetMaxScrollPosX=function(){var n=Math.max(this.m_oBody.scrollWidth-this.m_oBody.clientWidth,this.m_oBody.scrollWidth-document.documentElement.clientWidth,this.m_oWindow.scrollX);return Math.floor(n)};WDSaisieAPI.prototype.GetMaxScrollPosY=function(){var n=Math.max(this.m_oBody.scrollHeight-this.m_oBody.clientHeight,this.m_oBody.scrollHeight-document.documentElement.clientHeight,this.m_oWindow.scrollY);return Math.floor(n)};WDSaisieAPI.prototype.GetLargeurNecessaire=function(){return Math.floor(this.m_oBody.scrollWidth)};WDSaisieAPI.prototype.GetTabEnsemblePolice_JSON=function(){var t=[],n,i;elementDebut=this.m_oBody.firstChild;this.visisteElementDOM(elementDebut,null,function(n){var i=this.oGetCurrentStyle(n);return(i.fontFamily&&(t[i.fontFamily]=!0),n.firstChild)?EActionVisite.premierFils:n.nextSibling?EActionVisite.frereSuivant:EActionVisite.frereParent}.bind(this));n=[];for(i in t)n.push(i);return JSON.stringify(n)};WDSaisieAPI.prototype._bEstCharMotAt=function(n){var i,r,t,f,e,u;return n<0?!1:(i=this._oCalcElemeFromPos(n),!i.bTrouve)?!1:(r=this._oCalcElemeFromPos(n+1),!r.bTrouve)?!1:r.elem!=i.elem?!1:(t=this.m_oDocument.createRange(),t.selectNodeContents(i.elem),f=t.endOffset,t.selectNodeContents(r.elem),e=t.endOffset,t.setStart(i.elem,Math.min(f,i.offsetDansElem)),t.setEnd(r.elem,Math.min(e,r.offsetDansElem)),u=t.toString(),u=="")?!1:u==" "?!1:u=="_"?!1:u=="-"?!1:u.match(/[\p{Letter}\p{Number}]/u)};WDSaisieAPI.prototype.CMD_SelectionneMot=function(n){if(this._bEstCharMotAt(n)){for(var t=n,i=n;this._bEstCharMotAt(t-1);)t--;while(this._bEstCharMotAt(i))i++;this.CMD_Selectionne(t,i+1)}}